id: CVE-2021-3120

info:
  name: >
    YITH WooCommerce Gift Cards Premium <= 3.3.0 - Arbitrary File Upload
  author: topscoder
  severity: critical
  description: >
    An arbitrary file upload vulnerability in the YITH WooCommerce Gift Cards Premium plugin before 3.3.1 for WordPress allows remote attackers to achieve remote code execution on the operating system in the security context of the web server. In order to exploit this vulnerability, an attacker must be able to place a valid Gift Card product into the shopping cart. An uploaded file is placed at a predetermined path on the web server with a user-specified filename and extension. This occurs because the ywgc-upload-picture parameter can have a .php value even though the intention was to only allow uploads of Gift Card images.
  reference:
    - https://github.com/topscoder/nuclei-wordfence-cve
    - https://www.wordfence.com/threat-intel/vulnerabilities/id/2b6489f8-061d-4fbd-81f2-9f508dd0e7f8?source=api-prod
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2021-3120
  metadata:
    fofa-query: "wp-content/plugins/yith-woocommerce-gift-cards-premium/"
    google-query: inurl:"/wp-content/plugins/yith-woocommerce-gift-cards-premium/"
    shodan-query: 'vuln:CVE-2021-3120'
  tags: cve,wordpress,wp-plugin,yith-woocommerce-gift-cards-premium,critical

http:
  - method: GET
    redirects: true
    max-redirects: 3
    path:
      - "{{BaseURL}}/wp-content/plugins/yith-woocommerce-gift-cards-premium/readme.txt"

    extractors:
      - type: regex
        name: version
        part: body
        group: 1
        internal: true
        regex:
          - "(?mi)Stable tag: ([0-9.]+)"

      - type: regex
        name: version
        part: body
        group: 1
        regex:
          - "(?mi)Stable tag: ([0-9.]+)"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        words:
          - "yith-woocommerce-gift-cards-premium"
        part: body

      - type: dsl
        dsl:
          - compare_versions(version, '< 3.3.1')