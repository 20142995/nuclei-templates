id: CVE-2021-24328

info:
  name: >
    WP Login Security and History <= 1.0 - Cross-Site Request Forgery to Stored Cross-Site Scripting
  author: topscoder
  severity: high
  description: >
    The WP Login Security and History WordPress plugin through 1.0 did not have CSRF check when saving its settings, not any sanitisation or validation on them. This could allow attackers to make logged in administrators change the plugin's settings to arbitrary values, and set XSS payloads on them as well
  reference:
    - https://github.com/topscoder/nuclei-wordfence-cve
    - https://www.wordfence.com/threat-intel/vulnerabilities/id/78a411e3-5228-4ac2-bf39-6bdec5d9e313?source=api-prod
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H
    cvss-score: 8.8
    cve-id: CVE-2021-24328
  metadata:
    fofa-query: "wp-content/plugins/wp-login-security-and-history/"
    google-query: inurl:"/wp-content/plugins/wp-login-security-and-history/"
    shodan-query: 'vuln:CVE-2021-24328'
  tags: cve,wordpress,wp-plugin,wp-login-security-and-history,high

http:
  - method: GET
    redirects: true
    max-redirects: 3
    path:
      - "{{BaseURL}}/wp-content/plugins/wp-login-security-and-history/readme.txt"

    extractors:
      - type: regex
        name: version
        part: body
        group: 1
        internal: true
        regex:
          - "(?mi)Stable tag: ([0-9.]+)"

      - type: regex
        name: version
        part: body
        group: 1
        regex:
          - "(?mi)Stable tag: ([0-9.]+)"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        words:
          - "wp-login-security-and-history"
        part: body

      - type: dsl
        dsl:
          - compare_versions(version, '<= 1.0')