id: CVE-2023-3128

info:
  name: Grafana Azure AD OAuth Authentication Bypass
  author: ProjectDiscoveryAI
  severity: critical
  description: Grafana is validating Azure AD accounts based on the email claim which is not unique and can be easily modified, leading to authentication bypass and account takeover when Azure AD OAuth is configured with a multi-tenant app.
  impact: |
    Successful exploitation could lead to unauthorized access to sensitive information.
  remediation: |
    Apply the vendor-supplied patch or upgrade to a fixed version to mitigate the vulnerability.
  reference:
    - https://github.com/grafana/bugbounty/security/advisories/GHSA-gxh2-6vvc-rrgp
    - https://security.netapp.com/advisory/ntap-20230714-0004/
    - https://github.com/Threekiii/CVE
    - https://github.com/netlas-io/netlas-dorks
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:L
    cvss-score: 9.4
    cve-id: CVE-2023-3128
    cwe-id: CWE-290
    epss-score: 0.00192
    epss-percentile: 0.57786
    cpe: cpe:2.3:a:grafana:grafana:*:*:*:*:-:*:*:*
  metadata:
    vendor: grafana
    product: grafana
    shodan-query: title:"Grafana"
    fofa-query: app="Grafana"
    google-query: intitle:"grafana"

http:
  - method: GET
    path:
      - "{{BaseURL}}/login"

    matchers:
      - type: word
        words:
          - "Sign in with Azure AD"
        part: body
