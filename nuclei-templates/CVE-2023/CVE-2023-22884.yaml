id: CVE-2023-22884

info:
  name: Apache Airflow Command Injection Vulnerability
  author: ProjectDiscoveryAI
  severity: critical
  description: Improper Neutralization of Special Elements used in a Command ('Command Injection') vulnerability in Apache Software Foundation Apache Airflow and Apache Airflow MySQL Provider. This issue affects Apache Airflow versions before 2.5.1 and Apache Airflow MySQL Provider versions before 4.0.0.
  impact: |
    Successful exploitation could lead to unauthorized access, data leakage, and potential system compromise.
  remediation: |
    Upgrade to Apache Airflow version X.X.X or later to mitigate CVE-2023-22884.
  reference:
    - https://github.com/jakabakos/CVE-2023-22884-Airflow-SQLi
    - https://lists.apache.org/thread/0l0j3nt0t7fzrcjl2ch0jgj6c58kxs5h
    - https://github.com/abrahim7112/Vulnerability-checking-program-for-Android
    - https://github.com/kohnakagawa/kohnakagawa
    - https://github.com/nomi-sec/PoC-in-GitHub
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2023-22884
    cwe-id: CWE-77
    epss-score: 0.01201
    epss-percentile: 0.858
    cpe: cpe:2.3:a:apache:airflow:*:*:*:*:*:*:*:*
  metadata:
    vendor: apache
    product: airflow
    shodan-query: product:"redis"
    fofa-query: Apache Airflow
    google-query:
      - intitle:"airflow - dags"
      - intitle:"airflow - dags" || http.html:"apache airflow"
      - intitle:"sign in - airflow"

http:
  - method: POST
    path:
      - "{{BaseURL}}"

    headers:
      Content-Type: application/x-www-form-urlencoded

    body: |
      username=admin&password=admin&mode=attack&ci=mysql&di=bulk_load_from_file&dc=dag_config.json
    matchers:
      - type: word
        words:
          - "Successful exploitation"
        part: body
