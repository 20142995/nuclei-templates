id: CVE-2023-50292

info:
  name: Apache Solr Schema Designer 远程代码执行漏洞
  author: k3ppf0r
  severity: high
  description: |
    据描述，当Solr以SolrCloud模式启动时，攻击者可以利用Solr的sechema-designer系统功能上传恶意构造的solrconfig.xml文件，通过组合利用最终造成任意代码执行。
  reference:
    - https://github.com/trickest/cve/blob/main/2023/CVE-2023-50292.md
  remediation: |
    官方已发布漏洞补丁及修复版本，请评估业务是否受影响后，酌情升级至安全版本。【备注】：建议您在升级前做好数据备份工作，避免出现意外。
    建议使用安全防护类设备进行防护，重点关注/api/schema-designer/*相关路径
    在不影响正常系统功能和业务的前提下，避免开放至公网。
    对solr开启鉴权机制，防止未授权访问。
  classification:
    cvss-metrics: CVSS:3.1/AV:A/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 7.5
    cve-id: CVE-2023-50292
    cwe-id: CWE-732
    # epss-score: # 可选，例：0.97537
    # epss-percentile: # 可选，例：0.99993
    cpe: cpe:2.3:a:apache:solr:*:*:*:*:*:*:*:*
  metadata:
    date: 2024-02-09
    version: 8.10.0 <= Apache Solr <= 8.11.2, 9.0.0 <= Apache Solr < 9.3.0
  tags: cve,cve2024,Apache,Solr,rce

http:
  - raw:
      - |+
        GET /solr/admin/info/system?_=1713947479120&wt=json HTTP/1.1
        Host: {{Hostname}}
        Accept: application/json, text/plain, */*
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.6312.58 Safari/537.36
        X-Requested-With: XMLHttpRequest
        Referer: http://192.168.136.131:8983/solr/
        Accept-Encoding: gzip, deflate, br
        Accept-Language: zh-CN,zh;q=0.9
        Connection: close


    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - '"mode":"solrcloud"'

      - type: regex
        part: body
        regex:
          - '"solr-spec-version":"8\.(10\.\d+|11\.[0-2])"'
          - '"solr-spec-version":"9\.[0-2]\.\d+"'

      - type: status
        status:
          - 200
