id: CVE-2023-30130

info:
  name: CraftCMS 3.8.1 Server-Side Template Injection (SSTI)
  author: ProjectDiscoveryAI
  severity: high
  description: An issue in CraftCMS v.3.8.1 allows remote attackers to execute arbitrary code via a crafted script to the Section parameter.
  impact: |
    Successful exploitation could lead to remote code execution and compromise of the server.
  remediation: |
    Upgrade CraftCMS to version 3.8.2 or later to mitigate the Server-Side Template Injection vulnerability.
  reference:
    - https://tf1t.gitbook.io/mycve/craftcms/server-site-template-injection-on-craftcms-3.8.1
    - https://craftcms.com/
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H
    cvss-score: 8.8
    cve-id: CVE-2023-30130
    cwe-id: CWE-94
    epss-score: 0.0055
    epss-percentile: 0.78176
    cpe: cpe:2.3:a:craftcms:craft_cms:3.8.1:*:*:*:*:*:*:*
  metadata:
    vendor: craftcms
    product: craft_cms
    shodan-query: http.favicon.hash:-47932290
    fofa-query:
      - body="craftcms"
      - icon_hash="-47932290"
    publicwww-query: craftcms

http:
  - method: POST
    path:
      - "{{BaseURL}}/craft_cms/web/index.php?p=admin/actions/users/send-password-reset-email"

    headers:
      Content-Type: application/x-www-form-urlencoded
      X-CSRF-Token: Y6gyOuBAHhUN0BJn5W6WctXfds2d00I4SfLo0EtZ9zxiu-TCgmjyCBrQfA6UBHAgQJtKHrJY4h6diACDrZsITDGejrwfML1oKYOvkrsGuEo=
      X-Requested-With: XMLHttpRequest
      User-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 15_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) CriOS/98.0.4758.85 Mobile/15E148 Safari/604.1

    body: |
      loginName=admin
    matchers:
      - type: word
        words:
          - "Your password reset request was successful"
        part: body
