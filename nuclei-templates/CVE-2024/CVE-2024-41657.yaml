id: CVE-2024-41657

info:
  name: Casdoor CORS Misconfiguration Vulnerability
  author: ProjectDiscoveryAI
  severity: high
  description: |
    In Casdoor 1.577.0 and earlier, a logic vulnerability exists in the beego filter CorsFilter that allows any website to make cross domain requests to Casdoor as the logged in user. Due to the a logic error in checking only for a prefix when authenticating the Origin header, any domain can create a valid subdomain with a valid subdomain prefix (Ex: localhost.example.com), allowing the website to make requests to Casdoor as the current signed-in user.
  impact: |
    Potential data leakage and unauthorized access.
  remediation: |
    Configure proper CORS settings to restrict cross-origin requests.
  reference:
    - https://github.com/casdoor/casdoor/blob/v1.577.0/routers/cors_filter.go#L45
    - https://github.com/fkie-cad/nvd-json-data-feeds
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:N
    cvss-score: 8.1
    cve-id: CVE-2024-41657
    cwe-id: CWE-942,CWE-697
    epss-score: 0.00087
    epss-percentile: 0.38734
    cpe: cpe:2.3:a:casbin:casdoor:*:*:*:*:*:*:*:*
  metadata:
    vendor: casbin
    product: casdoor
    shodan-query: http.title:"Casdoor"
    fofa-query: title="casdoor"
    google-query: intitle:"casdoor"

http:
  - method: OPTIONS
    path:
      - "{{BaseURL}}/path-that-triggers-cors"

    headers:
      Origin: "http://localhost.evil.com"
      Access-Control-Request-Method: "POST"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: http://localhost.evil.com"
        part: header
