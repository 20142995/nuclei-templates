id: CVE-2021-38296

info:
  name: Apache Spark Full Encryption Key Recovery Vulnerability
  author: ProjectDiscoveryAI
  severity: high
  description: Apache Spark supports end-to-end encryption of RPC connections via "spark.authenticate" and "spark.network.crypto.enabled". In versions 3.1.2 and earlier, it uses a bespoke mutual authentication protocol that allows for full encryption key recovery. After an initial interactive attack, this would allow someone to decrypt plaintext traffic offline. Note that this does not affect security mechanisms controlled by "spark.authenticate.enableSaslEncryption", "spark.io.encryption.enabled", "spark.ssl", "spark.ui.strictTransportSecurity". Update to Apache Spark 3.1.3 or later.
  impact: |
    High - Allows unauthorized access to encrypted data.
  remediation: |
    Apply the necessary patches provided by Apache to mitigate the vulnerability.
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    cvss-score: 7.5
    cve-id: CVE-2021-38296
    cwe-id: CWE-294
    epss-score: 0.00058
    epss-percentile: 0.255
    cpe: cpe:2.3:a:apache:spark:*:*:*:*:*:*:*:*
  metadata:
    vendor: apache
    product: spark
    shodan-query: html:"/apps/IMT/Html/"
    fofa-query:
      - body="/apps/imt/html/"
      - title="spark master at"
    google-query: intitle:"spark master at"

http:
  - method: GET
    path:
      - "{{BaseURL}}/spark/version"

    matchers:
      - type: word
        words:
          - "Version: 3.1.2"
        part: body
