id: CVE-2021-43444

info:
  name: ONLYOFFICE Unauthenticated Remote Code Execution via WebSocket
  author: ProjectDiscoveryAI
  severity: high
  description: ONLYOFFICE all versions as of 2021-11-08 is affected by Incorrect Access Control. Signed document download URLs can be forged due to a weak default URL signing key.
  reference:
    - https://labs.nettitude.com/blog/exploiting-onlyoffice-web-sockets-for-unauthenticated-remote-code-execution/
    - https://github.com/nettitude/pwnlyoffice

network:
  - inputs:
      - data: "GET /websocket HTTP/1.1\r
Host: {{Hostname}}\r
User-Agent: Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.7113.93 Safari/537.36\r
Accept: */*\r
Accept-Language: en-GB,en;q=0.5\r
Accept-Encoding: gzip, deflate\r
Sec-WebSocket-Version: 13\r
Origin: http://localhost\r
Sec-WebSocket-Key: L9so59gHCxrpsnU4SPOsbw==\r
Connection: keep-alive, Upgrade\r
Cookie: sessionid=4795fab306588141e027f642b63debfb\r
Pragma: no-cache\r
Cache-Control: no-cache\r
Upgrade: websocket\r
\r
"
    host:
      - "{{Hostname}}"
    read-size: 2048
    matchers:
      - type: word
        words:
          - "Sec-WebSocket-Accept: uKmC7JGNT7wAZhZFtiSO5nvf1A8="
        part: data